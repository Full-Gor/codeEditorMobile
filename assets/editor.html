pas a ca place pour le remettre a sa place et ensuite supprimer les doublons.  <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Code Editor Mobile Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        /* Circuit Background Animation */
        .circuit-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0.5;
            background: #0a0a0a;
            pointer-events: none;
        }
        
        /* Electric Current Animation */
        .electric-current {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ffff00;
            border-radius: 50%;
            box-shadow: 
                0 0 10px #ffff00,
                0 0 20px #ffff00,
                0 0 30px #ffff00;
            animation: moveAlongPath 4s linear infinite;
            offset-rotate: 0deg;
        }
        
        .circuit-path {
            position: absolute;
            stroke: #1a1a1a;
            stroke-width: 2;
            fill: none;
            filter: drop-shadow(0 0 3px rgba(255, 255, 0, 0.3));
        }
        
        .circuit-path-glow {
            position: absolute;
            stroke: #ffff00;
            stroke-width: 3;
            fill: none;
            opacity: 0;
            filter: blur(5px);
            animation: pathGlow 4s linear infinite;
        }
        
        @keyframes pathGlow {
            0%, 100% {
                opacity: 0;
                stroke-dashoffset: 1000;
            }
            50% {
                opacity: 0.8;
                stroke-dashoffset: 0;
            }
        }
        
        .circuit-line {
            position: absolute;
            background: #2a2a2a;
            box-shadow: 
                0 0 2px rgba(255, 255, 0, 0.2),
                inset 0 0 2px rgba(255, 255, 0, 0.1);
        }
        
        .circuit-line::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 100%;
            background: radial-gradient(ellipse at center, 
                #ffff00 0%, 
                rgba(255, 255, 0, 0.8) 40%,
                transparent 70%);
            opacity: 0;
            animation: electricFlow 3s linear infinite;
            filter: blur(2px);
            box-shadow: 0 0 15px #ffff00;
        }
        
        .circuit-line.horizontal::after {
            height: 10px;
            top: -4px;
        }
        
        .circuit-line.vertical::after {
            width: 10px;
            height: 20px;
            left: -4px;
        }
        
        .circuit-line.horizontal {
            height: 2px;
            width: 100px;
        }
        
        .circuit-line.vertical {
            width: 2px;
            height: 100px;
        }
        
        .circuit-node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 50%;
            z-index: 2;
        }
        
        .circuit-node.active {
            background: #ffff00;
            box-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00;
            animation: nodePulse 2s ease-in-out infinite;
        }
        
        .circuit-led {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffff00;
            border-radius: 50%;
            opacity: 0.3;
            animation: ledBlink 1s ease-in-out infinite;
        }
        
        @keyframes moveAlongPath {
            0% {
                offset-distance: 0%;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                offset-distance: 100%;
                opacity: 0;
            }
        }
        
        @keyframes electricFlow {
            0% {
                transform: translateX(-100%) scaleX(0.3);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(500%) scaleX(0.3);
                opacity: 0;
            }
        }
        
        @keyframes nodePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00;
            }
            50% {
                transform: scale(1.2);
                box-shadow: 0 0 20px #ffff00, 0 0 40px #ffff00;
            }
        }
        
        @keyframes ledBlink {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 1;
                box-shadow: 0 0 5px #ffff00;
            }
        }
        
        /* Effet de scanlines */
        .circuit-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 0, 0.03) 2px,
                rgba(255, 255, 0, 0.03) 4px
            );
            pointer-events: none;
        }
        
        /* Effet de grille */
        .circuit-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 0, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(50px, 50px);
            }
        }
        .mobile-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(37, 37, 38, 0.98);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 0, 0.3);
            display: none;
            z-index: 1000;
            padding: 5px;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .mobile-toolbar.active {
            display: flex;
            gap: 5px;
        }
        
        .toolbar-btn {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid rgba(255, 255, 0, 0.3);
            color: #ffff00;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.3);
            flex-shrink: 0;
        }
        
        .toolbar-btn:active {
            background: rgba(255, 255, 0, 0.3);
            transform: scale(0.95);
        }
        
        .toolbar-separator {
            width: 1px;
            background: rgba(255, 255, 0, 0.3);
            margin: 0 5px;
            flex-shrink: 0;
        }
        
        /* Split View pour plusieurs √©diteurs */
        .editor-split-container {
            display: flex;
            flex: 1;
            gap: 2px;
            background: rgba(255, 255, 0, 0.1);
            position: relative;
        }
        
        .editor-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(10, 10, 10, 0.8);
            position: relative;
            overflow: hidden;
            min-width: 200px;
        }
        
        /* Resize Handle */
        .resize-handle {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 4px;
            background: rgba(255, 255, 0, 0.2);
            cursor: col-resize;
            z-index: 10;
            transition: all 0.2s;
        }
        
        .resize-handle:hover {
            background: rgba(255, 255, 0, 0.5);
            width: 6px;
        }
        
        .resize-handle.active {
            background: #ffff00;
            width: 6px;
        }
        
        .editor-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(10, 10, 10, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .editor-pane::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 40%, 
                rgba(255, 255, 0, 0.05) 0%, 
                transparent 50%);
            animation: rotateGradient 30s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotateGradient {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .editor-pane-header {
            background: rgba(37, 37, 38, 0.95);
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 0, 0.2);
            font-size: 12px;
        }
        
        .editor-pane-title {
            color: #ffff00;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .editor-pane-title::before {
            content: 'üìÑ';
            font-size: 14px;
        }
        
        .editor-pane[data-theme="cyberpunk"] .editor-pane-title::before {
            content: 'üåÉ';
        }
        
        .editor-pane[data-theme="cyberpunk-2077"] .editor-pane-title::before {
            content: 'üéÆ';
        }
        
        .editor-pane[data-theme="scarlet-protocol"] .editor-pane-title::before {
            content: 'üî¥';
        }
        
        .editor-pane[data-theme="neon-genesis"] .editor-pane-title::before {
            content: 'üíú';
        }
        
        .theme-switcher {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .theme-switcher:hover {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
        }
        
        /* Editor Background Circuit Effect */
        .editor-instance {
            flex: 1;
            position: relative;
        }
        
        .editor-instance::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 50px,
                    rgba(255, 255, 0, 0.02) 50px,
                    rgba(255, 255, 0, 0.02) 51px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 50px,
                    rgba(255, 255, 0, 0.02) 50px,
                    rgba(255, 255, 0, 0.02) 51px
                );
            pointer-events: none;
            z-index: 0;
        }
        
        .editor-instance::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 0, 0.03) 45%,
                rgba(255, 255, 0, 0.05) 50%,
                rgba(255, 255, 0, 0.03) 55%,
                transparent 100%);
            animation: scanAcross 8s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes scanAcross {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }
        
        .monaco-editor {
            background-color: transparent !important;
        }
        
        .monaco-editor .margin {
            background-color: transparent !important;
        }
        
        .monaco-editor .monaco-editor-background {
            background-color: rgba(10, 10, 10, 0.95) !important;
        }
        
        /* Per-editor theme indicators */
        .editor-pane[data-theme="cyberpunk"] .editor-pane-header {
            border-bottom-color: #ff1493;
        }
        
        .editor-pane[data-theme="scarlet-protocol"] .editor-pane-header {
            border-bottom-color: #ff0000;
        }
        
        .editor-pane.active .editor-pane-header {
            border-bottom: 2px solid #ffff00;
            box-shadow: 0 2px 10px rgba(255, 255, 0, 0.3);
        }
        
        /* Split View Controls */
        .split-controls {
            position: absolute;
            top: 10px;
            right: 60px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }
        
        .split-btn {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid rgba(255, 255, 0, 0.3);
            color: #ffff00;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .split-btn:hover {
            background: rgba(255, 255, 0, 0.2);
        }
        
        /* Circuit Background Enhancement */
        .circuit-corner {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255, 255, 0, 0.3);
            animation: cornerPulse 4s ease-in-out infinite;
        }
        
        @keyframes cornerPulse {
            0%, 100% {
                border-color: rgba(255, 255, 0, 0.3);
                box-shadow: none;
            }
            50% {
                border-color: rgba(255, 255, 0, 0.6);
                box-shadow: 0 0 15px rgba(255, 255, 0, 0.4);
            }
        }
        
        .circuit-corner.top-left {
            top: 20px;
            left: 20px;
            border-right: none;
            border-bottom: none;
            border-top-left-radius: 10px;
        }
        
        .circuit-corner.top-right {
            top: 20px;
            right: 20px;
            border-left: none;
            border-bottom: none;
            border-top-right-radius: 10px;
        }
        
        .circuit-corner.bottom-left {
            bottom: 20px;
            left: 20px;
            border-right: none;
            border-top: none;
            border-bottom-left-radius: 10px;
        }
        
        .circuit-corner.bottom-right {
            bottom: 20px;
            right: 20px;
            border-left: none;
            border-top: none;
            border-bottom-right-radius: 10px;
        }
        
        .circuit-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(255, 255, 0, 0.1) 0%, 
                transparent 70%);
            animation: pulsate 4s ease-in-out infinite;
        }
        
        @keyframes pulsate {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.1;
            }
        }
        
        /* Hexagon Grid Overlay */
        .hex-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            background-image: 
                repeating-linear-gradient(30deg, 
                    transparent, 
                    transparent 40px, 
                    rgba(255, 255, 0, 0.1) 40px, 
                    rgba(255, 255, 0, 0.1) 41px),
                repeating-linear-gradient(90deg, 
                    transparent, 
                    transparent 40px, 
                    rgba(255, 255, 0, 0.1) 40px, 
                    rgba(255, 255, 0, 0.1) 41px),
                repeating-linear-gradient(150deg, 
                    transparent, 
                    transparent 40px, 
                    rgba(255, 255, 0, 0.1) 40px, 
                    rgba(255, 255, 0, 0.1) 41px);
        }
        
        /* Editor Background Circuit Effect */
        .editor-instance::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 50px,
                    rgba(255, 255, 0, 0.02) 50px,
                    rgba(255, 255, 0, 0.02) 51px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 50px,
                    rgba(255, 255, 0, 0.02) 50px,
                    rgba(255, 255, 0, 0.02) 51px
                );
            pointer-events: none;
            z-index: 0;
        }
        
        .monaco-editor {
            background-color: transparent !important;
        }
        
        .monaco-editor .margin {
            background-color: transparent !important;
        }
        
        .monaco-editor .monaco-editor-background {
            background-color: rgba(10, 10, 10, 0.95) !important;
        }
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 0, 0.5) 50%, 
                transparent 100%);
            top: 0;
            animation: scanDown 8s linear infinite;
            filter: blur(1px);
        }
        
        @keyframes scanDown {
            0% {
                top: -2px;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }
        @keyframes glitch {
            0%, 100% {
                transform: translate(0);
                filter: hue-rotate(0deg);
            }
            20% {
                transform: translate(-1px, 1px);
                filter: hue-rotate(90deg);
            }
            40% {
                transform: translate(1px, -1px);
                filter: hue-rotate(180deg);
            }
            60% {
                transform: translate(0, 1px);
                filter: hue-rotate(270deg);
            }
            80% {
                transform: translate(-1px, 0);
                filter: hue-rotate(360deg);
            }
        }
        
        .circuit-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 0, 0.02);
            animation: glitch 10s linear infinite;
            pointer-events: none;
            mix-blend-mode: screen;
        }
        
        /* Header */
        .header {
            background: rgba(45, 45, 48, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 8px;
            gap: 8px;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255, 255, 0, 0.2);
            position: relative;
            z-index: 10;
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
            color: #ffff00;
            margin-right: auto;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }
        
        .header-btn {
            background: none;
            border: none;
            color: #ccc;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            position: relative;
        }
        
        .header-btn:hover {
            background: #3e3e42;
            color: #fff;
        }
        
        .header-btn.active {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
            border: 1px solid rgba(255, 255, 0, 0.4);
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);
        }
        
        .header-btn.run-btn {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
            border: 1px solid rgba(255, 255, 0, 0.4);
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        .header-btn.run-btn:hover {
            background: rgba(255, 255, 0, 0.3);
            border-color: #ffff00;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }
        
        /* Menu Fichier */
        .file-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(37, 37, 38, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 0, 0.2);
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(255, 255, 0, 0.1);
            display: none;
            z-index: 1000;
            min-width: 220px;
        }
        
        .file-menu.active {
            display: block;
        }
        
        .file-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid #3e3e42;
            transition: background 0.2s;
        }
        
        .file-menu-item:last-child {
            border-bottom: none;
        }
        
        .file-menu-item:hover {
            background: #094771;
        }
        
        .file-menu-item span {
            float: right;
            color: #888;
            font-size: 11px;
        }
        
        /* Tabs */
        .tabs-container {
            background: rgba(37, 37, 38, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            overflow-x: auto;
            scrollbar-width: thin;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255, 255, 0, 0.1);
            position: relative;
            z-index: 10;
        }
        
        .tab {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #2d2d30;
            border-right: 1px solid #252526;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: background 0.2s;
        }
        
        .tab.active {
            background: #1e1e1e;
            color: #fff;
        }
        
        .tab:hover {
            background: #37373d;
        }
        
        .tab-close {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.5;
            font-size: 16px;
        }
        
        .tab-close:hover {
            opacity: 1;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
            z-index: 5;
        }
        
        /* Explorer am√©lior√© */
        .explorer {
            width: 250px;
            background: rgba(37, 37, 38, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 0, 0.1);
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s;
            position: relative;
            z-index: 10;
        }
        
        .explorer.hidden {
            margin-left: -250px;
        }
        
        .explorer-header {
            background: #2d2d30;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3e3e42;
        }
        
        .explorer-title {
            font-size: 12px;
            text-transform: uppercase;
            color: #ccc;
        }
        
        .explorer-actions {
            display: flex;
            gap: 8px;
        }
        
        .explorer-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .explorer-btn:hover {
            background: #3e3e42;
            color: #fff;
        }
        
        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        
        .tree-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background 0.2s;
            gap: 6px;
            user-select: none;
            white-space: nowrap;
        }
        
        .tree-item:hover {
            background: #37373d;
        }
        
        .tree-item.active {
            background: #094771;
        }
        
        .tree-item.folder {
            font-weight: 500;
        }
        
        .tree-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tree-arrow {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .tree-arrow.expanded {
            transform: rotate(90deg);
        }
        
        .tree-children {
            display: none;
        }
        
        .tree-children.expanded {
            display: block;
        }
        
        .tree-indent {
            display: inline-block;
            width: 20px;
        }
        
        /* Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 5;
        }
        
        .editor-wrapper {
            flex: 1;
            position: relative;
            display: none;
        }
        
        .editor-wrapper.active {
            display: block;
        }
        
        #editor {
            width: 100%;
            height: 100%;
        }
        
        /* Preview Container */
        .preview-container {
            flex: 1;
            display: none;
            background: #fff;
            position: relative;
        }
        
        .preview-container.active {
            display: block;
        }
        
        .preview-header {
            background: #f3f3f3;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .preview-url {
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }
        
        .preview-close {
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }
        
        .preview-frame {
            width: 100%;
            height: calc(100% - 40px);
            border: none;
        }
        
        /* Media Viewer */
        .media-viewer {
            flex: 1;
            display: none;
            background: #1e1e1e;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .media-viewer.active {
            display: flex;
        }
        
        .media-content {
            max-width: 100%;
            max-height: 100%;
        }
        
        .media-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .media-content video,
        .media-content audio {
            max-width: 100%;
            outline: none;
        }
        
        .media-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Search Panel */
        .search-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 500px;
            display: none;
            z-index: 200;
        }
        
        .search-panel.active {
            display: block;
        }
        
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .search-result {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 4px;
            transition: background 0.2s;
        }
        
        .search-result:hover {
            background: #37373d;
        }
        
        /* Theme Selector */
        .theme-selector {
            position: absolute;
            top: 50px;
            right: 10px;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 8px;
            display: none;
            z-index: 150;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .theme-selector.active {
            display: block;
        }
        
        .theme-option {
            padding: 6px 12px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .theme-option:hover {
            background: #37373d;
        }
        
        /* Status Bar */
        .status-bar {
            background: rgba(255, 255, 0, 0.1);
            border-top: 1px solid rgba(255, 255, 0, 0.3);
            color: #ffff00;
            padding: 4px 12px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 10;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        .status-info {
            display: flex;
            gap: 20px;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 60px;
            right: 20px;
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid rgba(255, 255, 0, 0.4);
            color: #ffff00;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 13px;
            display: none;
            animation: slideIn 0.3s, slideOut 0.3s 2.7s;
            z-index: 1000;
            backdrop-filter: blur(10px);
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        .notification.success {
            background: rgba(73, 255, 84, 0.1);
            border-color: rgba(73, 255, 84, 0.4);
            color: #49ff54;
            text-shadow: 0 0 5px rgba(73, 255, 84, 0.5);
        }
        
        .notification.error {
            background: rgba(255, 53, 69, 0.1);
            border-color: rgba(255, 53, 69, 0.4);
            color: #ff3545;
            text-shadow: 0 0 5px rgba(255, 53, 69, 0.5);
        }
        
        @keyframes slideIn {
            from { transform: translateX(300px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(300px); opacity: 0; }
        }
        
        /* Input file cach√© */
        #fileInput, #folderInput {
            display: none;
        }
        
        /* Bouton flottant pour mobile */
        .fab-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            display: none;
            flex-direction: column-reverse;
            gap: 10px;
            z-index: 100;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 0, 0.2);
            border: 2px solid rgba(255, 255, 0, 0.4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffff00;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(255, 255, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
        }
        
        .fab:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 0, 0.3);
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }
        
        .fab-menu {
            background: #252526;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: none;
        }
        
        .fab-menu.active {
            display: block;
        }
        
        .fab-item {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            white-space: nowrap;
            transition: background 0.2s;
        }
        
        .fab-item:hover {
            background: #37373d;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .explorer {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                z-index: 50;
                box-shadow: 2px 0 5px rgba(0,0,0,0.3);
            }
            
            .explorer.hidden {
                left: -250px;
            }
            
            .fab-container {
                display: flex;
                bottom: 60px;
            }
            
            .header-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .editor-container {
                margin-bottom: 50px;
            }
            
            .split-controls {
                display: none;
            }
            
            .circuit-background {
                opacity: 0.3;
            }
            
            .help-btn {
                bottom: 120px;
            }
            
            .mobile-toolbar {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* Dialogs */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .dialog-overlay.active {
            display: flex;
        }
        
        .dialog {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .dialog-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .dialog-input {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .dialog-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .dialog-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }
        
        .dialog-btn.primary {
            background: #0e639c;
            color: #fff;
        }
        
        .dialog-btn.primary:hover {
            background: #1177bb;
        }
        
        .dialog-btn.secondary {
            background: #3e3e42;
            color: #ccc;
        }
        
        .dialog-btn.secondary:hover {
            background: #4e4e52;
        }
    </style>
</head>
<body>
    <!-- Circuit Background Animation -->
    <div class="circuit-background" id="circuitBg">
        <div class="circuit-grid"></div>
        <div class="hex-grid"></div>
        <div class="circuit-pulse"></div>
        <div class="circuit-corner top-left"></div>
        <div class="circuit-corner top-right"></div>
        <div class="circuit-corner bottom-left"></div>
        <div class="circuit-corner bottom-right"></div>
        <div class="scan-line"></div>
        <div class="circuit-overlay"></div>
    </div>
    
    <div class="header">
        <div class="logo">CodeEdit Pro</div>
        <div style="position: relative;">
            <button class="header-btn" onclick="toggleFileMenu()" id="fileMenuBtn">üìÑ Fichier</button>
            <div class="file-menu" id="fileMenu">
                <div class="file-menu-item" onclick="openFile()">
                    Ouvrir un fichier <span>Ctrl+O</span>
                </div>
                <div class="file-menu-item" onclick="openFolder()">
                    Ouvrir un dossier
                </div>
                <div class="file-menu-item" onclick="saveFile()">
                    Enregistrer <span>Ctrl+S</span>
                </div>
                <div class="file-menu-item" onclick="saveAsFile()">
                    Enregistrer sous... <span>Ctrl+Shift+S</span>
                </div>
                <div class="file-menu-item" onclick="newFile()">
                    Nouveau fichier <span>Ctrl+N</span>
                </div>
                <div class="file-menu-item" onclick="newFolder()">
                    Nouveau dossier
                </div>
            </div>
        </div>
        <button class="header-btn" onclick="toggleExplorer()" id="explorerBtn">üìÅ</button>
        <button class="header-btn" onclick="toggleSearch()">üîç</button>
        <button class="header-btn run-btn" onclick="runProject()">‚ñ∂Ô∏è Run</button>
        <button class="header-btn" onclick="toggleTheme()">üé®</button>
    </div>
    
    <div class="tabs-container" id="tabs"></div>
    
    <div class="main-content">
        <div class="explorer hidden" id="explorer">
            <div class="explorer-header">
                <span class="explorer-title">Explorateur</span>
                <div class="explorer-actions">
                    <button class="explorer-btn" onclick="newFile()" title="Nouveau fichier">üìÑ</button>
                    <button class="explorer-btn" onclick="newFolder()" title="Nouveau dossier">üìÅ</button>
                    <button class="explorer-btn" onclick="toggleExplorer()" title="Fermer">‚úï</button>
                </div>
            </div>
            <div class="file-tree" id="fileTree"></div>
        </div>
        
        <div class="editor-container">
            <div class="split-controls">
                <button class="split-btn" onclick="toggleSplitView()">‚¨ú Split</button>
                <button class="split-btn" onclick="closeSplitView()">‚úï</button>
            </div>
            <div class="editor-split-container" id="editorSplitContainer">
                <div class="editor-pane active" id="editorPane1" data-theme="vs-dark">
                    <div class="editor-pane-header">
                        <div class="editor-pane-title">
                            <span id="paneTitle1">√âditeur 1</span>
                        </div>
                        <button class="theme-switcher" onclick="showPaneThemeMenu(1)">üé®</button>
                    </div>
                    <div class="editor-instance" id="editor1Container">
                        <div id="editor"></div>
                    </div>
                </div>
            </div>
            <div class="editor-wrapper active" id="editorWrapper" style="display: none;">
                <div id="editorOld"></div>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <div class="preview-header">
                    <span class="preview-url">Preview: <span id="previewUrl"></span></span>
                    <span class="preview-close" onclick="closePreview()">‚úï</span>
                </div>
                <iframe class="preview-frame" id="previewFrame"></iframe>
            </div>
            
            <div class="media-viewer" id="mediaViewer">
                <button class="media-close" onclick="closeMediaViewer()">‚úï</button>
                <div class="media-content" id="mediaContent"></div>
            </div>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-info">
            <span id="cursorPosition">Ln 1, Col 1</span>
            <span id="languageMode">HTML</span>
            <span id="fileStatus">Non enregistr√©</span>
        </div>
        <div>
            <span>! + Tab = HTML5 | Alt+Click = Multi-curseur</span>
        </div>
    </div>
    
    <div class="search-panel" id="searchPanel">
        <div class="search-header">
            <h3 style="margin: 0;">Rechercher</h3>
            <span class="preview-close" onclick="toggleSearch()">‚úï</span>
        </div>
        <input type="text" class="search-input" placeholder="Rechercher dans le projet..." id="searchInput" />
        <div class="search-results" id="searchResults"></div>
    </div>
    
    <div class="theme-selector" id="themeSelector">
        <div class="theme-option" onclick="changeTheme('vs-dark')">üåô Dark (d√©faut)</div>
        <div class="theme-option" onclick="changeTheme('vs')">‚òÄÔ∏è Light</div>
        <div class="theme-option" onclick="changeTheme('hc-black')">‚ö° High Contrast</div>
        <div class="theme-option" onclick="changeTheme('scarlet-protocol')">üî¥ SCARLET Protocol</div>
        <div class="theme-option" onclick="changeTheme('cyberpunk')">üåÉ Cyberpunk</div>
        <div class="theme-option" onclick="changeTheme('cyberpunk-2077')">üéÆ Cyberpunk 2077</div>
        <div class="theme-option" onclick="changeTheme('neon-genesis')">üíú Neon Genesis</div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <!-- Inputs cach√©s pour les fichiers -->
    <input type="file" id="fileInput" accept="*">
    <input type="file" id="folderInput" webkitdirectory directory multiple>
    
    <!-- Dialogs -->
    <div class="dialog-overlay" id="dialogOverlay">
        <div class="dialog">
            <div class="dialog-title" id="dialogTitle">Nouveau</div>
            <input type="text" class="dialog-input" id="dialogInput" placeholder="Nom...">
            <div class="dialog-actions">
                <button class="dialog-btn secondary" onclick="closeDialog()">Annuler</button>
                <button class="dialog-btn primary" id="dialogConfirm">Cr√©er</button>
            </div>
        </div>
    </div>
    
    <!-- Bouton flottant pour mobile -->
    <div class="fab-container">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item" onclick="runProject()">‚ñ∂Ô∏è Run projet</div>
            <div class="fab-item" onclick="saveFile()">üíæ Enregistrer</div>
            <div class="fab-item" onclick="saveAsFile()">üíæ Enregistrer sous...</div>
            <div class="fab-item" onclick="openFile()">üìÇ Ouvrir fichier</div>
            <div class="fab-item" onclick="newFile()">üìÑ Nouveau fichier</div>
            <div class="fab-item" onclick="newFolder()">üìÅ Nouveau dossier</div>
        </div>
        <div class="fab" onclick="toggleFabMenu()">+</div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <script>
        // Configuration Monaco Editor
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
        
        let editor;
        let editor2 = null;
        let currentEditor = null;
        let currentFile = null;
        let currentFileHandle = null;
        let openTabs = [];
        let fileSystem = {
            'Mon Projet': {
                type: 'folder',
                expanded: true,
                children: {
                    'src': {
                        type: 'folder',
                        expanded: false,
                        children: {
                            'index.html': {
                                type: 'file',
                                    content: ``,
                                language: 'html'
                            },
                            'style.css': {
                                type: 'file',
                                content: `body {
    margin: 0;
    padding: 0;
    background: #0a0a0a;
    color: #fff;
    font-family: 'Courier New', monospace;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
}

.container {
    text-align: center;
    padding: 40px;
}

.neon-text {
    font-size: 3em;
    color: #ffff00;
    text-shadow: 
        0 0 10px #ffff00,
        0 0 20px #ffff00,
        0 0 30px #ffff00;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
}

.cyber-btn {
    background: transparent;
    border: 2px solid #ffff00;
    color: #ffff00;
    padding: 15px 40px;
    font-size: 1.2em;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    margin-top: 30px;
}

.cyber-btn:hover {
    background: #ffff00;
    color: #0a0a0a;
    box-shadow: 0 0 20px #ffff00;
}`,
                                language: 'css'
                            }
                        }
                    },
                    'scripts': {
                        type: 'folder',
                        expanded: false,
                        children: {
                            'app.js': {
                                type: 'file',
                                content: `
console.log("System initialized...");


document.addEventListener('DOMContentLoaded', () => {
    const btn = document.querySelector('.cyber-btn');
    
    btn.addEventListener('click', () => {
        console.log('Launching cyberdeck...');
        
        // Effet de glitch
        btn.style.animation = 'glitch 0.3s';
        
        setTimeout(() => {
            btn.style.animation = '';
            alert('Welcome to the Matrix, Samurai!');
        }, 300);
    });
    
    // Effet de typing sur le titre
    const title = document.querySelector('.neon-text');
    const text = title.textContent;
    title.textContent = '';
    
    let i = 0;
    const typeWriter = setInterval(() => {
        if (i < text.length) {
            title.textContent += text.charAt(i);
            i++;
        } else {
            clearInterval(typeWriter);
        }
    }, 100);
});`,
                                language: 'javascript'
                            }
                        }
                    },
                    'README.md': {
                        type: 'file',
                        content: `# Mon Projet Cyberpunk 2077

## üéÆ Bienvenue dans CodeEdit Pro

Cet √©diteur de code mobile est inspir√© de l'univers Cyberpunk 2077 avec des animations de circuits √©lectriques.

### üöÄ Fonctionnalit√©s

- **Multi-√©diteurs** : Divisez l'√©cran et codez sur plusieurs fichiers
- **Th√®mes personnalis√©s** : Chaque √©diteur peut avoir son propre th√®me
- **Animations cyberpunk** : Circuits anim√©s en arri√®re-plan
- **Support mobile** : Toolbar avec raccourcis tactiles

### üìÅ Structure du projet

\`\`\`
Mon Projet/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.html    # Page principale
‚îÇ   ‚îî‚îÄ‚îÄ style.css     # Styles cyberpunk
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ app.js        # Logique JavaScript
‚îî‚îÄ‚îÄ README.md         # Ce fichier
\`\`\`

### üí° Conseils

1. Utilisez **! + Tab** pour cr√©er une structure HTML5
2. **Ctrl+S** pour t√©l√©charger vos fichiers
3. **Split View** pour coder efficacement
4. Explorez les diff√©rents th√®mes cyberpunk

### üåÉ Wake up, Samurai...

We have code to burn! üî•`,
                        language: 'markdown'
                    }
                }
            }
        };
        let isModified = false;
        let currentPath = [];
        let splitViewActive = false;
        let editorThemes = {
            1: 'vs-dark',
            2: 'cyberpunk-2077'
        };
        let activeFiles = {
            1: null,
            2: null
        };
        
        // D√©tection du support File System Access API
        const supportsFileSystemAccess = 'showOpenFilePicker' in window;
        
        // Types de fichiers support√©s
        const fileTypes = {
            code: ['html', 'htm', 'css', 'js', 'jsx', 'ts', 'tsx', 'json', 'php', 'md', 'txt', 'xml', 'svg'],
            image: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'ico'],
            video: ['mp4', 'webm', 'ogg', 'mov'],
            audio: ['mp3', 'wav', 'ogg', 'flac', 'm4a']
        };
        
        // D√©finition des th√®mes personnalis√©s
        const customThemes = {
            'scarlet-protocol': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '8B0000' },
                    { token: 'keyword', foreground: 'FF0000' },
                    { token: 'string', foreground: 'DC143C' },
                    { token: 'number', foreground: 'FF6347' },
                    { token: 'variable', foreground: 'FF1493' },
                    { token: 'function', foreground: 'FF69B4' },
                    { token: 'type', foreground: 'B22222' }
                ],
                colors: {
                    'editor.background': '#1a0000',
                    'editor.foreground': '#FFB6C1',
                    'editor.lineHighlightBackground': '#330000',
                    'editor.selectionBackground': '#660000',
                    'editorCursor.foreground': '#FF0000',
                    'editorLineNumber.foreground': '#8B0000'
                }
            },
            'cyberpunk': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '00CED1' },
                    { token: 'keyword', foreground: 'FF1493' },
                    { token: 'string', foreground: '00FF00' },
                    { token: 'number', foreground: 'FFD700' },
                    { token: 'variable', foreground: 'FF00FF' },
                    { token: 'function', foreground: '00FFFF' },
                    { token: 'type', foreground: 'FF69B4' }
                ],
                colors: {
                    'editor.background': '#0a0a0a',
                    'editor.foreground': '#00FF00',
                    'editor.lineHighlightBackground': '#1a1a1a',
                    'editor.selectionBackground': '#FF149344',
                    'editorCursor.foreground': '#00FFFF',
                    'editorLineNumber.foreground': '#FF1493'
                }
            },
            'cyberpunk-2077': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: 'FFFF00' },
                    { token: 'keyword', foreground: 'FF0080' },
                    { token: 'string', foreground: '00FFFF' },
                    { token: 'number', foreground: 'FFFF00' },
                    { token: 'variable', foreground: 'FF00FF' },
                    { token: 'function', foreground: '00FF00' },
                    { token: 'type', foreground: 'FF0080' }
                ],
                colors: {
                    'editor.background': '#0F0F0F',
                    'editor.foreground': '#F0F0F0',
                    'editor.lineHighlightBackground': '#1F1F1F',
                    'editor.selectionBackground': '#FF008044',
                    'editorCursor.foreground': '#FFFF00',
                    'editorLineNumber.foreground': '#FF0080'
                }
            },
            'neon-genesis': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '9370DB' },
                    { token: 'keyword', foreground: 'FF00FF' },
                    { token: 'string', foreground: '00CED1' },
                    { token: 'number', foreground: 'FF1493' },
                    { token: 'variable', foreground: 'DA70D6' },
                    { token: 'function', foreground: 'FF69B4' },
                    { token: 'type', foreground: 'EE82EE' }
                ],
                colors: {
                    'editor.background': '#0a0015',
                    'editor.foreground': '#E6E6FA',
                    'editor.lineHighlightBackground': '#1a0025',
                    'editor.selectionBackground': '#9370DB44',
                    'editorCursor.foreground': '#FF00FF',
                    'editorLineNumber.foreground': '#9370DB'
                }
            }
        };
        
        // Initialisation de l'√©diteur
        require(['vs/editor/editor.main'], function() {
            // Enregistrer les th√®mes personnalis√©s
            Object.entries(customThemes).forEach(([name, theme]) => {
                monaco.editor.defineTheme(name, theme);
            });
            
            // Configuration Emmet
            monaco.languages.registerCompletionItemProvider('html', {
                provideCompletionItems: function(model, position) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });
                    
                    const match = textUntilPosition.match(/([\w\-!]+(?:[>+][\w\-]+)*(?:\*\d+)?(?:\[[\w\-]+(?:=["']?[\w\s]+["']?)?\])*(?:\{[^}]+\})?(?:#[\w\-]+)?(?:\.[\w\-]+)*|!)$/);
                    
                    if (!match) return { suggestions: [] };
                    
                    const emmetExpression = match[1];
                    const expandedHtml = expandEmmet(emmetExpression);
                    
                    if (!expandedHtml) return { suggestions: [] };
                    
                    return {
                        suggestions: [{
                            label: emmetExpression,
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: expandedHtml,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            detail: 'Emmet Abbreviation',
                            documentation: expandedHtml,
                            range: {
                                startLineNumber: position.lineNumber,
                                endLineNumber: position.lineNumber,
                                startColumn: position.column - emmetExpression.length,
                                endColumn: position.column
                            }
                        }]
                    };
                },
                triggerCharacters: ['>', '*', '+', '.', '#', '[', '{', '!']
            });
            
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `// Bienvenue dans CodeEdit Pro - Cyberpunk Edition!
// 
// ‚ö° NOUVELLES FONCTIONNALIT√âS:
// 
// üåä ANIMATIONS DE FOND:
// ‚Ä¢ Circuits √©lectriques anim√©s avec courant jaune
// ‚Ä¢ Particules lumineuses traversant l'√©cran
// ‚Ä¢ LEDs clignotantes et n≈ìuds pulsants
// 
// üì± TOOLBAR MOBILE:
// ‚Ä¢ Raccourcis: <> * ! div class # ..
// ‚Ä¢ Actions: Copier, Coller, Sauvegarder, Run
// ‚Ä¢ S'affiche automatiquement sur mobile
// 
// üé® MULTI-TH√àMES PAR √âDITEUR:
// ‚Ä¢ Cliquez sur ‚¨ú Split pour diviser l'√©cran
// ‚Ä¢ Chaque √©diteur peut avoir son propre th√®me
// ‚Ä¢ Redimensionnez en glissant la barre centrale
// 
// üìÅ EXPLORATEUR AM√âLIOR√â:
// ‚Ä¢ Arborescence compl√®te avec dossiers/fichiers
// ‚Ä¢ Cliquez sur ‚ñ∂ pour ouvrir/fermer les dossiers
// ‚Ä¢ Double-clic pour ouvrir les fichiers
// 
// üíæ SAUVEGARDE:
// ‚Ä¢ Ctrl+S t√©l√©charge le fichier actuel
// ‚Ä¢ Les modifications sont gard√©es en m√©moire
// 
// üìù RACCOURCIS:
// ‚Ä¢ ! + Tab = Structure HTML5 compl√®te
// ‚Ä¢ li*5 + Tab = 5 √©l√©ments <li>
// ‚Ä¢ Ctrl+S = Sauvegarder (t√©l√©charger)
// ‚Ä¢ Ctrl+R = Run preview
// ‚Ä¢ Alt+Click = Multi-curseur
// 
// üöÄ D√âMARRAGE RAPIDE:
// 1. Explorez les fichiers d'exemple dans l'explorateur
// 2. Cr√©ez vos propres fichiers avec Fichier > Nouveau
// 3. Utilisez Split pour coder sur plusieurs fichiers
// 
// Wake up, Samurai. We have code to burn.`,
                language: 'javascript',
                theme: 'vs-dark',
                minimap: { enabled: false },
                fontSize: 14,
                wordWrap: 'on',
                automaticLayout: true,
                scrollBeyondLastLine: false,
                quickSuggestions: true,
                parameterHints: { enabled: true },
                suggestOnTriggerCharacters: true,
                tabSize: 2,
                insertSpaces: true,
                formatOnPaste: true,
                formatOnType: true,
                multiCursorModifier: 'alt',
                mouseWheelZoom: true,
                cursorBlinking: 'smooth',
                smoothScrolling: true,
                renderWhitespace: 'selection',
                renderLineHighlight: 'all'
            });
            
            currentEditor = editor;
            
            // Gestion du focus
            editor.onDidFocusEditorText(() => {
                currentEditor = editor;
                document.getElementById('editorPane1').classList.add('active');
                if (document.getElementById('editorPane2')) {
                    document.getElementById('editorPane2').classList.remove('active');
                }
            });
            
            // Gestion du multi-curseur
            editor.onMouseDown((e) => {
                if (e.event.altKey) {
                    e.event.preventDefault();
                    e.event.stopPropagation();
                }
            });
            
            // Mise √† jour de la position du curseur
            editor.onDidChangeCursorPosition((e) => {
                const position = e.position;
                document.getElementById('cursorPosition').textContent = `Ln ${position.lineNumber}, Col ${position.column}`;
            });
            
            // D√©tection des modifications
            editor.onDidChangeModelContent(() => {
                if (activeFiles[1] && !isModified) {
                    isModified = true;
                    updateFileStatus();
                    // Sauvegarder le contenu dans le syst√®me de fichiers
                    const filePath = findFileInSystem(activeFiles[1]);
                    if (filePath) {
                        filePath.content = editor.getValue();
                    }
                }
            });
            
            // Configuration mobile
            if (window.innerWidth < 768) {
                editor.updateOptions({ fontSize: 12 });
            }
            
            // Raccourci Tab pour Emmet
            editor.addCommand(monaco.KeyCode.Tab, () => {
                const position = editor.getPosition();
                const model = editor.getModel();
                const textBeforeCursor = model.getValueInRange({
                    startLineNumber: position.lineNumber,
                    startColumn: 1,
                    endLineNumber: position.lineNumber,
                    endColumn: position.column
                });
                
                const emmetMatch = textBeforeCursor.match(/([\w\-!]+(?:[>+][\w\-]+)*(?:\*\d+)?(?:\[[\w\-]+(?:=["']?[\w\s]+["']?)?\])*(?:\{[^}]+\})?(?:#[\w\-]+)?(?:\.[\w\-]+)*|!)$/);
                
                if (emmetMatch) {
                    const emmetExpression = emmetMatch[1];
                    const expandedHtml = expandEmmet(emmetExpression);
                    
                    if (expandedHtml) {
                        const range = new monaco.Range(
                            position.lineNumber,
                            position.column - emmetExpression.length,
                            position.lineNumber,
                            position.column
                        );
                        
                        editor.executeEdits('emmet', [{
                            range: range,
                            text: expandedHtml,
                            forceMoveMarkers: true
                        }]);
                        
                        // Positionner le curseur dans le body pour !
                        if (emmetExpression === '!') {
                            const newPosition = editor.getPosition();
                            const model = editor.getModel();
                            const match = model.findMatches('<body>', false, false, false, null, false)[0];
                            if (match) {
                                editor.setPosition({
                                    lineNumber: match.range.endLineNumber + 1,
                                    column: 5
                                });
                            }
                        }
                        
                        showNotification(`Emmet: ${emmetExpression} ‚Üí Expans√©!`);
                        return;
                    }
                }
                
                // Comportement Tab normal
                editor.trigger('keyboard', 'type', { text: '\t' });
            });
        });
        
        // Fonction d'expansion Emmet am√©lior√©e
        function expandEmmet(abbreviation) {
            // Raccourci ! pour doctype HTML5
            if (abbreviation === '!') {
                return `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    $0
    <!-- Mobile Toolbar -->
    <div class="mobile-toolbar" id="mobileToolbar">
        <button class="toolbar-btn" onclick="insertText('<>')"><></button>
        <button class="toolbar-btn" onclick="insertText('</>')"></></button>
        <button class="toolbar-btn" onclick="insertText('*')">*</button>
        <button class="toolbar-btn" onclick="insertText('!')">!</button>
        <button class="toolbar-btn" onclick="insertText('div')">div</button>
        <button class="toolbar-btn" onclick="insertText('class=\"\"')">class</button>
        <button class="toolbar-btn" onclick="insertText('id=\"\"')">id</button>
        <button class="toolbar-btn" onclick="insertText('#')">#</button>
        <button class="toolbar-btn" onclick="insertText('.')">..</button>
        <button class="toolbar-btn" onclick="insertText('{}')">{}</button>
        <button class="toolbar-btn" onclick="insertText('()')">()</button>
        <button class="toolbar-btn" onclick="insertText('[]')">[]</button>
        <div class="toolbar-separator"></div>
        <button class="toolbar-btn" onclick="selectAll()">‚¨ö</button>
        <button class="toolbar-btn" onclick="copyText()">üìã</button>
        <button class="toolbar-btn" onclick="pasteText()">üìÑ</button>
        <button class="toolbar-btn" onclick="cutText()">‚úÇÔ∏è</button>
        <button class="toolbar-btn" onclick="undoEdit()">‚Ü∂</button>
        <button class="toolbar-btn" onclick="redoEdit()">‚Ü∑</button>
        <div class="toolbar-separator"></div>
        <button class="toolbar-btn" onclick="saveFile()">üíæ</button>
        <button class="toolbar-btn" onclick="runProject()">‚ñ∂Ô∏è</button>
        <button class="toolbar-btn" onclick="toggleSplitView()">‚¨ú</button>
        <button class="toolbar-btn" onclick="formatCode()">{ }</button>
        <button class="toolbar-btn" onclick="toggleExplorer()">üìÅ</button>
    </div>
    
    <!-- Loading Indicator -->
    <div class="loading-indicator" id="loadingIndicator">
        <div>‚ö°</div>
        <div>Chargement...</div>
    </div>
    
    <!-- Help Button -->
    <button class="help-btn" onclick="showHelp()" title="Aide">?</button>
    
    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>
</body>
</html>`;
            }
            
            // Parse multiplication
            const multiplyMatch = abbreviation.match(/^(.+)\*(\d+)$/);
            let baseAbbr = abbreviation;
            let count = 1;
            
            if (multiplyMatch) {
                baseAbbr = multiplyMatch[1];
                count = parseInt(multiplyMatch[2]);
            }
            
            // Parse basic tag avec classes et id
            const tagMatch = baseAbbr.match(/^(\w+)(#[\w-]+)?(\.[\w-]+)*$/);
            if (!tagMatch) return null;
            
            const tag = tagMatch[1];
            const id = tagMatch[2] ? tagMatch[2].substring(1) : '';
            const classes = baseAbbr.match(/\.[\w-]+/g);
            const classStr = classes ? classes.map(c => c.substring(1)).join(' ') : '';
            
            let result = '';
            
            for (let i = 0; i < count; i++) {
                let attrs = '';
                if (id) attrs += ` id="${id}"`;
                if (classStr) attrs += ` class="${classStr}"`;
                
                result += `<${tag}${attrs}></${tag}>\n`;
            }
            
            return result.trim();
        }
        
        // Fonction de notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Gestion du menu fichier
        function toggleFileMenu() {
            const menu = document.getElementById('fileMenu');
            menu.classList.toggle('active');
            document.getElementById('fileMenuBtn').classList.toggle('active');
        }
        
        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-btn') && !e.target.closest('.file-menu')) {
                document.getElementById('fileMenu').classList.remove('active');
                document.getElementById('fileMenuBtn').classList.remove('active');
            }
            
            if (!e.target.closest('.theme-selector') && !e.target.matches('[onclick*="toggleTheme"]')) {
                document.getElementById('themeSelector').classList.remove('active');
            }
        });
        
        // Ouvrir un fichier
        async function openFile() {
            toggleFileMenu();
            
            if (supportsFileSystemAccess) {
                try {
                    const [fileHandle] = await window.showOpenFilePicker({
                        multiple: false
                    });
                    
                    const file = await fileHandle.getFile();
                    const extension = file.name.split('.').pop().toLowerCase();
                    
                    // V√©rifier le type de fichier
                    if (fileTypes.code.includes(extension)) {
                        // Fichier de code
                        const content = await file.text();
                        currentFileHandle = fileHandle;
                        currentFile = file.name;
                        
                        const language = getLanguageFromExtension(extension);
                        
                        fileSystem[file.name] = {
                            type: 'file',
                            content: content,
                            language: language,
                            handle: fileHandle
                        };
                        
                        openFileInEditor(file.name, currentEditor === editor2 ? 2 : 1);
                        
                    } else if (fileTypes.image.includes(extension)) {
                        // Image
                        showMediaViewer('image', URL.createObjectURL(file), file.name);
                        
                    } else if (fileTypes.video.includes(extension)) {
                        // Vid√©o
                        showMediaViewer('video', URL.createObjectURL(file), file.name);
                        
                    } else if (fileTypes.audio.includes(extension)) {
                        // Audio
                        showMediaViewer('audio', URL.createObjectURL(file), file.name);
                        
                    } else {
                        const extension = name.split('.').pop().toLowerCase();
                        if (fileTypes.code.includes(extension)) {
                            openFileInEditor(name, currentEditor === editor2 ? 2 : 1);
                        } else if (file.handle) {
                            // Ouvrir les m√©dias
                            file.handle.getFile().then(f => {
                                const url = URL.createObjectURL(f);
                                const type = fileTypes.image.includes(extension) ? 'image' : 
                                             fileTypes.video.includes(extension) ? 'video' : 'audio';
                                showMediaViewer(type, url, name);
                            });
                        }
                    };
                    
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Erreur lors de l\'ouverture du fichier', 'error');
                    }
                }
            } else {
                // Fallback pour les navigateurs qui ne supportent pas l'API
                document.getElementById('fileInput').click();
            }
        }
        
        // Fallback pour input file
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const extension = file.name.split('.').pop().toLowerCase();
                
                if (fileTypes.code.includes(extension)) {
                    const content = await file.text();
                    const language = getLanguageFromExtension(extension);
                    
                    addFileToSystem(file.name, {
                        type: 'file',
                        content: content,
                        language: language
                    });
                    
                    openFileInEditor(file.name, currentEditor === editor2 ? 2 : 1);
                    
                } else if (fileTypes.image.includes(extension) || 
                          fileTypes.video.includes(extension) || 
                          fileTypes.audio.includes(extension)) {
                    const url = URL.createObjectURL(file);
                    const type = fileTypes.image.includes(extension) ? 'image' : 
                                 fileTypes.video.includes(extension) ? 'video' : 'audio';
                    showMediaViewer(type, url, file.name);
                }
            }
        });
        
        // Afficher le viewer m√©dia
        function showMediaViewer(type, url, filename) {
            const mediaContent = document.getElementById('mediaContent');
            mediaContent.innerHTML = '';
            
            if (type === 'image') {
                mediaContent.innerHTML = `<img src="${url}" alt="${filename}">`;
            } else if (type === 'video') {
                mediaContent.innerHTML = `<video src="${url}" controls></video>`;
            } else if (type === 'audio') {
                mediaContent.innerHTML = `<audio src="${url}" controls></audio>`;
            }
            
            document.getElementById('editorSplitContainer').style.display = 'none';
            document.getElementById('editorWrapper').style.display = 'none';
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('mediaViewer').classList.add('active');
            
            showNotification(`Ouvert: ${filename}`, 'success');
        }
        
        // Fermer le viewer m√©dia
        function closeMediaViewer() {
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('editorSplitContainer').style.display = 'flex';
        }
        
        // Afficher l'√©diteur de code
        function showCodeEditor() {
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('editorSplitContainer').style.display = 'flex';
        }
        
        // Run le projet
        function runProject() {
            const activeEditor = currentEditor || editor;
            const content = activeEditor.getValue();
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            document.getElementById('previewUrl').textContent = currentFile || 'preview.html';
            document.getElementById('previewFrame').src = url;
            
            document.getElementById('editorSplitContainer').style.display = 'none';
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('previewContainer').classList.add('active');
            
            showNotification('Preview lanc√©e!', 'success');
        }
        
        // Fermer la preview
        function closePreview() {
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('editorSplitContainer').style.display = 'flex';
        }
        
        // Sauvegarder le fichier
        async function saveFile() {
            toggleFileMenu();
            
            const activeEditor = currentEditor || editor;
            const activeFileNum = currentEditor === editor2 ? 2 : 1;
            const filename = activeFiles[activeFileNum] || currentFile;
            
            if (!filename) {
                saveAsFile();
                return;
            }
            
            const content = activeEditor.getValue();
            
            // Mettre √† jour le contenu dans le syst√®me de fichiers
            const file = findFileInSystem(filename);
            if (file) {
                file.content = content;
            }
            
            // Dans l'interface Claude, on t√©l√©charge directement le fichier
            downloadFile(filename, content);
            
            isModified = false;
            updateFileStatus();
            showNotification(`Fichier t√©l√©charg√©: ${filename}`, 'success');
        }
        
        // Enregistrer sous
        async function saveAsFile() {
            toggleFileMenu();
            
            const activeEditor = currentEditor || editor;
            const content = activeEditor.getValue();
            
            const filename = prompt('Nom du fichier:', currentFile || 'nouveau-fichier.html');
            if (filename) {
                // Ajouter le fichier au syst√®me
                const extension = filename.split('.').pop();
                const language = getLanguageFromExtension(extension);
                
                fileSystem[filename] = {
                    type: 'file',
                    content: content,
                    language: language
                };
                
                // T√©l√©charger le fichier
                downloadFile(filename, content);
                
                currentFile = filename;
                const activeFileNum = currentEditor === editor2 ? 2 : 1;
                activeFiles[activeFileNum] = filename;
                
                isModified = false;
                updateFileStatus();
                updateFileTree();
                showNotification(`Fichier t√©l√©charg√©: ${filename}`, 'success');
            }
        }
        
        // T√©l√©charger le fichier (fallback)
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Nouveau fichier
        function newFile() {
            toggleFileMenu();
            
            showDialog('Nouveau fichier', 'nouveau.html', (filename) => {
                if (filename) {
                    const extension = filename.split('.').pop();
                    const language = getLanguageFromExtension(extension);
                    
                    // Ajouter √† la racine du syst√®me de fichiers
                    addFileToSystem(filename, {
                        type: 'file',
                        content: '',
                        language: language
                    });
                    
                    openFileInEditor(filename, currentEditor === editor2 ? 2 : 1);
                }
            });
        }
        
        // Nouveau dossier
        function newFolder() {
            toggleFileMenu();
            
            showDialog('Nouveau dossier', 'nouveau-dossier', (foldername) => {
                if (foldername) {
                    addFileToSystem(foldername, {
                        type: 'folder',
                        expanded: false,
                        children: {}
                    });
                    
                    updateFileTree();
                    showNotification(`Nouveau dossier: ${foldername}`, 'success');
                }
            });
        }
        
        function addFileToSystem(name, item) {
            // Ajouter √† la racine du premier dossier
            const rootFolder = Object.values(fileSystem).find(item => item.type === 'folder');
            if (rootFolder && rootFolder.children) {
                rootFolder.children[name] = item;
            } else {
                fileSystem[name] = item;
            }
            updateFileTree();
        }
        
        // Afficher une bo√Æte de dialogue
        function showDialog(title, defaultValue, callback) {
            const overlay = document.getElementById('dialogOverlay');
            const dialogTitle = document.getElementById('dialogTitle');
            const dialogInput = document.getElementById('dialogInput');
            const dialogConfirm = document.getElementById('dialogConfirm');
            
            dialogTitle.textContent = title;
            dialogInput.value = defaultValue;
            overlay.classList.add('active');
            
            dialogInput.focus();
            dialogInput.select();
            
            const confirm = () => {
                const value = dialogInput.value.trim();
                if (value) {
                    callback(value);
                    closeDialog();
                }
            };
            
            dialogConfirm.onclick = confirm;
            dialogInput.onkeypress = (e) => {
                if (e.key === 'Enter') confirm();
            };
        }
        
        // Fermer la bo√Æte de dialogue
        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('active');
        }
        
        // Ouvrir un dossier
        async function openFolder() {
            toggleFileMenu();
            
            if ('showDirectoryPicker' in window) {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    // R√©initialiser le syst√®me de fichiers
                    fileSystem = {};
                    fileSystem[dirHandle.name] = {
                        type: 'folder',
                        expanded: true,
                        children: {}
                    };
                    
                    await loadDirectory(dirHandle, fileSystem[dirHandle.name].children);
                    updateFileTree();
                    showNotification('Dossier ouvert!', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Erreur lors de l\'ouverture du dossier', 'error');
                    }
                }
            } else {
                showNotification('Votre navigateur ne supporte pas l\'ouverture de dossiers', 'error');
            }
        }
        
        // Charger un dossier r√©cursivement
        async function loadDirectory(dirHandle, parentObj) {
            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'file') {
                    const file = await entry.getFile();
                    const extension = entry.name.split('.').pop().toLowerCase();
                    
                    // Tous les types de fichiers
                    const allTypes = [...fileTypes.code, ...fileTypes.image, ...fileTypes.video, ...fileTypes.audio];
                    
                    if (allTypes.includes(extension)) {
                        parentObj[entry.name] = {
                            type: 'file',
                            handle: entry,
                            language: getLanguageFromExtension(extension)
                        };
                        
                        // Charger le contenu pour les fichiers de code
                        if (fileTypes.code.includes(extension)) {
                            parentObj[entry.name].content = await file.text();
                        }
                    }
                } else if (entry.kind === 'directory') {
                    parentObj[entry.name] = {
                        type: 'folder',
                        expanded: false,
                        children: {}
                    };
                    await loadDirectory(entry, parentObj[entry.name].children);
                }
            }
        }
        
        // Obtenir le langage depuis l'extension
        function getLanguageFromExtension(extension) {
            const languageMap = {
                'html': 'html',
                'htm': 'html',
                'css': 'css',
                'js': 'javascript',
                'jsx': 'javascript',
                'ts': 'typescript',
                'tsx': 'typescript',
                'json': 'json',
                'php': 'php',
                'md': 'markdown',
                'txt': 'plaintext',
                'xml': 'xml',
                'svg': 'xml'
            };
            
            return languageMap[extension] || 'plaintext';
        }
        
        // Mise √† jour du statut du fichier
        function updateFileStatus() {
            const status = document.getElementById('fileStatus');
            if (currentFile) {
                status.textContent = isModified ? `${currentFile} (modifi√©)` : currentFile;
            } else {
                status.textContent = isModified ? 'Non enregistr√© (modifi√©)' : 'Non enregistr√©';
            }
            
            // Mettre √† jour le titre de l'onglet
            if (currentFile && openTabs.includes(currentFile)) {
                updateTabs();
            }
        }
        
        // Gestion des onglets
        function updateTabs() {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';
            
            openTabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab' + (tab === currentFile ? ' active' : '');
                const file = findFileInSystem(tab);
                const modified = file && isModified && tab === currentFile ? '‚Ä¢ ' : '';
                tabEl.innerHTML = `
                    <span onclick="openFileInEditor('${tab}', 1)">${modified}${tab}</span>
                    <span class="tab-close" onclick="closeTab('${tab}')">&times;</span>
                `;
                tabsContainer.appendChild(tabEl);
            });
        }
        
        function openTab(filename) {
            if (!openTabs.includes(filename)) {
                openTabs.push(filename);
            }
            switchFile(filename);
        }
        
        function switchFile(filename) {
            if (fileSystem[filename] && fileSystem[filename].type === 'file') {
                const file = fileSystem[filename];
                const extension = filename.split('.').pop().toLowerCase();
                
                if (fileTypes.code.includes(extension)) {
                    currentFile = filename;
                    currentFileHandle = file.handle || null;
                    showCodeEditor();
                    editor.setValue(file.content || '');
                    monaco.editor.setModelLanguage(editor.getModel(), file.language);
                    document.getElementById('languageMode').textContent = file.language.toUpperCase();
                    isModified = false;
                    updateTabs();
                    updateFileTree();
                    updateFileStatus();
                } else if (fileTypes.image.includes(extension) || 
                          fileTypes.video.includes(extension) || 
                          fileTypes.audio.includes(extension)) {
                    // Ouvrir le m√©dia
                    if (file.handle) {
                        file.handle.getFile().then(f => {
                            const url = URL.createObjectURL(f);
                            const type = fileTypes.image.includes(extension) ? 'image' : 
                                         fileTypes.video.includes(extension) ? 'video' : 'audio';
                            showMediaViewer(type, url, filename);
                        });
                    }
                }
            }
        }
        
        function closeTab(filename) {
            const index = openTabs.indexOf(filename);
            if (index > -1) {
                openTabs.splice(index, 1);
                if (currentFile === filename && openTabs.length > 0) {
                    switchFile(openTabs[openTabs.length - 1]);
                } else if (openTabs.length === 0) {
                    currentFile = null;
                    currentFileHandle = null;
                    editor.setValue('');
                    updateFileStatus();
                }
                updateTabs();
            }
        }
        
        // Gestion de l'arborescence am√©lior√©e
        function updateFileTree() {
            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '';
            
            renderTreeRecursive(fileSystem, fileTree, 0);
        }
        
        function renderTreeRecursive(items, container, level) {
            Object.entries(items).forEach(([name, item]) => {
                const treeItem = document.createElement('div');
                treeItem.className = 'tree-item';
                
                // Indentation
                const indent = document.createElement('span');
                indent.className = 'tree-indent';
                indent.style.width = `${level * 20}px`;
                treeItem.appendChild(indent);
                
                if (item.type === 'folder') {
                    // Fl√®che pour dossier
                    const arrow = document.createElement('span');
                    arrow.className = 'tree-arrow' + (item.expanded ? ' expanded' : '');
                    arrow.innerHTML = '‚ñ∂';
                    arrow.onclick = (e) => {
                        e.stopPropagation();
                        item.expanded = !item.expanded;
                        updateFileTree();
                    };
                    treeItem.appendChild(arrow);
                    
                    // Ic√¥ne et nom du dossier
                    treeItem.classList.add('folder');
                    const icon = document.createElement('span');
                    icon.className = 'tree-icon';
                    icon.textContent = item.expanded ? 'üìÇ' : 'üìÅ';
                    treeItem.appendChild(icon);
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = name;
                    treeItem.appendChild(nameSpan);
                    
                    container.appendChild(treeItem);
                    
                    // Enfants du dossier
                    if (item.children && item.expanded) {
                        const childrenContainer = document.createElement('div');
                        childrenContainer.className = 'tree-children expanded';
                        container.appendChild(childrenContainer);
                        renderTreeRecursive(item.children, childrenContainer, level + 1);
                    }
                } else {
                    // Fichier
                    const spacer = document.createElement('span');
                    spacer.style.width = '16px';
                    spacer.style.display = 'inline-block';
                    treeItem.appendChild(spacer);
                    
                    const icon = document.createElement('span');
                    icon.className = 'tree-icon';
                    icon.textContent = getFileIcon(name);
                    treeItem.appendChild(icon);
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = name;
                    treeItem.appendChild(nameSpan);
                    
                    if (name === currentFile || name === activeFiles[1] || name === activeFiles[2]) {
                        treeItem.classList.add('active');
                    }
                    
                    treeItem.onclick = () => {
                        openFileInEditor(name, currentEditor === editor2 ? 2 : 1);
                    };
                    
                    container.appendChild(treeItem);
                }
            });
        }
        
        function findFileInSystem(filename, obj = fileSystem) {
            for (const [key, value] of Object.entries(obj)) {
                if (key === filename && value.type === 'file') {
                    return value;
                } else if (value.type === 'folder' && value.children) {
                    const found = findFileInSystem(filename, value.children);
                    if (found) return found;
                }
            }
            return null;
        }
        
        function openFileInEditor(filename, editorNumber = 1) {
            const file = findFileInSystem(filename);
            if (!file) return;
            
            const targetEditor = editorNumber === 1 ? editor : editor2;
            if (!targetEditor) return;
            
            // Mettre √† jour le fichier actif
            activeFiles[editorNumber] = filename;
            currentFile = filename;
            
            // Charger le contenu
            targetEditor.setValue(file.content || '');
            monaco.editor.setModelLanguage(targetEditor.getModel(), file.language);
            
            // Mettre √† jour l'UI
            document.getElementById(`paneTitle${editorNumber}`).textContent = filename;
            if (!openTabs.includes(filename)) {
                openTabs.push(filename);
            }
            
            isModified = false;
            updateTabs();
            updateFileTree();
            updateFileStatus();
            
            showNotification(`Fichier ouvert: ${filename}`, 'success');
        }
        
        function getFileIcon(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'html': 'üìÑ',
                'css': 'üé®',
                'js': 'üìú',
                'jsx': '‚öõÔ∏è',
                'ts': 'üìò',
                'tsx': '‚öõÔ∏è',
                'json': 'üìã',
                'php': 'üêò',
                'md': 'üìù',
                'txt': 'üìÉ',
                'jpg': 'üñºÔ∏è',
                'jpeg': 'üñºÔ∏è',
                'png': 'üñºÔ∏è',
                'gif': 'üñºÔ∏è',
                'webp': 'üñºÔ∏è',
                'mp4': 'üé¨',
                'webm': 'üé¨',
                'mp3': 'üéµ',
                'wav': 'üéµ'
            };
            
            return iconMap[extension] || 'üìÑ';
        }
        
        // Toggle functions
        function toggleExplorer() {
            const explorer = document.getElementById('explorer');
            explorer.classList.toggle('hidden');
            document.getElementById('explorerBtn').classList.toggle('active');
        }
        
        function toggleSearch() {
            const panel = document.getElementById('searchPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                document.getElementById('searchInput').focus();
            }
        }
        
        function toggleTheme() {
            document.getElementById('themeSelector').classList.toggle('active');
        }
        
        function changeTheme(theme) {
            monaco.editor.setTheme(theme);
            document.getElementById('themeSelector').classList.remove('active');
            
            // Les th√®mes gardent maintenant le style cyberpunk de la barre de statut
            // pour une coh√©rence avec l'animation de fond
        }
        
        // Recherche
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            searchResults.innerHTML = '';
            
            if (query.length > 0) {
                searchFilesRecursive(fileSystem, query, searchResults);
            }
        });
        
        function searchFilesRecursive(items, query, container) {
            Object.entries(items).forEach(([name, item]) => {
                if (item.type === 'file') {
                    if (name.toLowerCase().includes(query) || 
                        (item.content && item.content.toLowerCase().includes(query))) {
                        const result = document.createElement('div');
                        result.className = 'search-result';
                        result.textContent = name;
                        result.onclick = () => {
                            openFileInEditor(name, currentEditor === editor2 ? 2 : 1);
                            toggleSearch();
                        };
                        container.appendChild(result);
                    }
                } else if (item.type === 'folder' && item.children) {
                    searchFilesRecursive(item.children, query, container);
                }
            });
        }
        
        // Menu flottant mobile
        function toggleFabMenu() {
            document.getElementById('fabMenu').classList.toggle('active');
        }
        
        // Gestion am√©lior√©e des erreurs
        window.addEventListener('error', (e) => {
            console.error('Erreur:', e);
            showNotification('Une erreur est survenue. V√©rifiez la console.', 'error');
        });
        
        // Raccourcis clavier am√©lior√©s
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 's') {
                    e.preventDefault();
                    saveFile();
                } else if (e.key === 'S') {
                    e.preventDefault();
                    saveAsFile();
                } else if (e.key === 'o') {
                    e.preventDefault();
                    openFile();
                } else if (e.key === 'n') {
                    e.preventDefault();
                    newFile();
                } else if (e.key === 'f') {
                    e.preventDefault();
                    toggleSearch();
                } else if (e.key === 'r') {
                    e.preventDefault();
                    runProject();
                } else if (e.key === 'b') {
                    e.preventDefault();
                    toggleExplorer();
                }
            }
        });
        
        // Mobile Toolbar Functions
        function insertText(text) {
            if (currentEditor) {
                const selection = currentEditor.getSelection();
                const id = { major: 1, minor: 1 };
                const op = {
                    identifier: id,
                    range: selection,
                    text: text,
                    forceMoveMarkers: true
                };
                currentEditor.executeEdits("insert", [op]);
                
                // Pour les tags avec attributs, positionner le curseur
                if (text.includes('""')) {
                    const position = currentEditor.getPosition();
                    currentEditor.setPosition({
                        lineNumber: position.lineNumber,
                        column: position.column - 1
                    });
                }
                currentEditor.focus();
            }
        }
        
        function undoEdit() {
            if (currentEditor) {
                currentEditor.trigger('keyboard', 'undo', null);
                currentEditor.focus();
            }
        }
        
        function redoEdit() {
            if (currentEditor) {
                currentEditor.trigger('keyboard', 'redo', null);
                currentEditor.focus();
            }
        }
        
        function selectAll() {
            if (currentEditor) {
                const model = currentEditor.getModel();
                currentEditor.setSelection(new monaco.Range(1, 1, model.getLineCount(), model.getLineMaxColumn(model.getLineCount())));
                currentEditor.focus();
            }
        }
        
        function copyText() {
            if (currentEditor) {
                currentEditor.focus();
                document.execCommand('copy');
                showNotification('Copi√©!', 'success');
            }
        }
        
        function pasteText() {
            if (currentEditor) {
                currentEditor.focus();
                document.execCommand('paste');
            }
        }
        
        function cutText() {
            if (currentEditor) {
                currentEditor.focus();
                document.execCommand('cut');
            }
        }
        
        function formatCode() {
            if (currentEditor) {
                currentEditor.getAction('editor.action.formatDocument').run();
                showNotification('Code format√©!', 'success');
            }
        }
        
        // Split View Functions
        function toggleSplitView() {
            if (!splitViewActive) {
                createSplitView();
            } else {
                closeSplitView();
            }
        }
        
        function createSplitView() {
            if (splitViewActive) return;
            
            const container = document.getElementById('editorSplitContainer');
            
            // Cr√©er le handle de redimensionnement
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            resizeHandle.style.left = '50%';
            resizeHandle.style.transform = 'translateX(-50%)';
            
            // Cr√©er le deuxi√®me panneau
            const pane2 = document.createElement('div');
            pane2.className = 'editor-pane';
            pane2.id = 'editorPane2';
            pane2.setAttribute('data-theme', 'cyberpunk-2077');
            pane2.innerHTML = `
                <div class="editor-pane-header">
                    <div class="editor-pane-title">
                        <span id="paneTitle2">√âditeur 2</span>
                    </div>
                    <button class="theme-switcher" onclick="showPaneThemeMenu(2)">üé®</button>
                </div>
                <div class="editor-instance" id="editor2Container"></div>
            `;
            
            container.appendChild(resizeHandle);
            container.appendChild(pane2);
            
            // Cr√©er le deuxi√®me √©diteur
            editor2 = monaco.editor.create(document.getElementById('editor2Container'), {
                value: '// S√©lectionnez un fichier dans l\'explorateur',
                language: 'javascript',
                theme: 'cyberpunk-2077',
                minimap: { enabled: false },
                fontSize: 14,
                wordWrap: 'on',
                automaticLayout: true,
                scrollBeyondLastLine: false
            });
            
            // Gestion du focus pour mobile
            if (window.innerWidth <= 768) {
                editor2.onDidFocusEditorText(() => {
                    currentEditor = editor2;
                    document.getElementById('mobileToolbar').classList.add('active');
                    document.body.classList.add('mobile-keyboard-active');
                    document.getElementById('editorPane1').classList.remove('active');
                    document.getElementById('editorPane2').classList.add('active');
                });
                
                editor2.onDidBlurEditorText(() => {
                    setTimeout(() => {
                        if (currentEditor !== editor) {
                            document.getElementById('mobileToolbar').classList.remove('active');
                            document.body.classList.remove('mobile-keyboard-active');
                        }
                    }, 200);
                });
            } else {
                editor2.onDidFocusEditorText(() => {
                    currentEditor = editor2;
                    document.getElementById('editorPane1').classList.remove('active');
                    document.getElementById('editorPane2').classList.add('active');
                });
            }
            
            // Gestion des modifications pour editor2
            if (editor2) {
                editor2.onDidChangeModelContent(() => {
                    if (activeFiles[2] && !isModified) {
                        isModified = true;
                        updateFileStatus();
                        // Sauvegarder le contenu
                        const filePath = findFileInSystem(activeFiles[2]);
                        if (filePath) {
                            filePath.content = editor2.getValue();
                        }
                    }
                });
            }
            
            // Gestion du redimensionnement
            let isResizing = false;
            let startX = 0;
            let startWidthLeft = 0;
            let startWidthRight = 0;
            
            resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                const pane1 = document.getElementById('editorPane1');
                const pane2 = document.getElementById('editorPane2');
                startWidthLeft = pane1.offsetWidth;
                startWidthRight = pane2.offsetWidth;
                resizeHandle.classList.add('active');
                document.body.style.cursor = 'col-resize';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                const deltaX = e.clientX - startX;
                const container = document.getElementById('editorSplitContainer');
                const containerWidth = container.offsetWidth;
                
                const newWidthLeft = startWidthLeft + deltaX;
                const newWidthRight = startWidthRight - deltaX;
                
                if (newWidthLeft > 200 && newWidthRight > 200) {
                    const percentLeft = (newWidthLeft / containerWidth) * 100;
                    const percentRight = (newWidthRight / containerWidth) * 100;
                    
                    document.getElementById('editorPane1').style.flex = `0 0 ${percentLeft}%`;
                    document.getElementById('editorPane2').style.flex = `0 0 ${percentRight}%`;
                    resizeHandle.style.left = `${percentLeft}%`;
                    
                    // Redimensionner les √©diteurs
                    editor.layout();
                    editor2.layout();
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizeHandle.classList.remove('active');
                    document.body.style.cursor = '';
                }
            });
            
            splitViewActive = true;
            
            // Redimensionner les √©diteurs
            setTimeout(() => {
                editor.layout();
                editor2.layout();
            }, 100);
            
            showNotification('Vue divis√©e activ√©e! Glissez la barre centrale pour redimensionner.', 'success');
        }
        
        function closeSplitView() {
            if (!splitViewActive) return;
            
            const pane2 = document.getElementById('editorPane2');
            const resizeHandle = document.querySelector('.resize-handle');
            
            if (pane2) pane2.remove();
            if (resizeHandle) resizeHandle.remove();
            
            if (editor2) {
                editor2.dispose();
                editor2 = null;
            }
            
            // R√©initialiser la taille du premier panneau
            document.getElementById('editorPane1').style.flex = '1';
            
            splitViewActive = false;
            currentEditor = editor;
            activeFiles[2] = null;
            
            setTimeout(() => {
                editor.layout();
            }, 100);
            
            showNotification('Vue divis√©e ferm√©e!', 'success');
        }
        
        function showPaneThemeMenu(paneNumber) {
            const themes = [
                { name: 'Dark', value: 'vs-dark' },
                { name: 'Light', value: 'vs' },
                { name: 'SCARLET Protocol', value: 'scarlet-protocol' },
                { name: 'Cyberpunk', value: 'cyberpunk' },
                { name: 'Cyberpunk 2077', value: 'cyberpunk-2077' },
                { name: 'Neon Genesis', value: 'neon-genesis' }
            ];
            
            const menu = document.createElement('div');
            menu.className = 'theme-selector';
            menu.style.position = 'absolute';
            menu.style.top = '30px';
            menu.style.right = '10px';
            menu.style.display = 'block';
            menu.style.zIndex = '1000';
            
            themes.forEach(theme => {
                const option = document.createElement('div');
                option.className = 'theme-option';
                option.textContent = theme.name;
                option.onclick = () => {
                    changePaneTheme(paneNumber, theme.value);
                    menu.remove();
                };
                menu.appendChild(option);
            });
            
            document.getElementById(`editorPane${paneNumber}`).appendChild(menu);
            
            // Fermer le menu si on clique ailleurs
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!e.target.closest('.theme-selector')) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }
        
        function changePaneTheme(paneNumber, theme) {
            const targetEditor = paneNumber === 1 ? editor : editor2;
            if (targetEditor) {
                targetEditor.updateOptions({ theme: theme });
                document.getElementById(`editorPane${paneNumber}`).setAttribute('data-theme', theme);
                editorThemes[paneNumber] = theme;
                showNotification(`Th√®me ${theme} appliqu√© √† l'√©diteur ${paneNumber}!`, 'success');
            }
        }
        
        // D√©tecter le focus sur mobile pour afficher la toolbar
        function setupMobileToolbar() {
            if (window.innerWidth <= 768) {
                // √âcouter le focus sur les √©diteurs
                editor.onDidFocusEditorText(() => {
                    currentEditor = editor;
                    document.getElementById('mobileToolbar').classList.add('active');
                    document.body.classList.add('mobile-keyboard-active');
                });
                
                editor.onDidBlurEditorText(() => {
                    setTimeout(() => {
                        if (currentEditor !== editor2) {
                            document.getElementById('mobileToolbar').classList.remove('active');
                            document.body.classList.remove('mobile-keyboard-active');
                        }
                    }, 200);
                });
            }
        }
        
        // Initialisation
        updateFileTree();
        updateFileStatus();
        setupMobileToolbar();
        document.getElementById('editorPane1').classList.add('active');
        
        // Ouvrir l'explorateur par d√©faut sur desktop
        if (window.innerWidth > 768) {
            document.getElementById('explorer').classList.remove('hidden');
            document.getElementById('explorerBtn').classList.add('active');
        }
        
        // Ajuster la hauteur de l'√©diteur sur mobile
        if (window.innerWidth <= 768) {
            const adjustEditorHeight = () => {
                const toolbar = document.getElementById('mobileToolbar');
                const editorContainer = document.querySelector('.editor-container');
                if (toolbar.classList.contains('active')) {
                    editorContainer.style.marginBottom = '50px';
                } else {
                    editorContainer.style.marginBottom = '0';
                }
            };
            
            setInterval(adjustEditorHeight, 100);
        }
        
        // G√©n√©ration du circuit de fond
        generateCircuitBackground();
        
        function generateCircuitBackground() {
            const circuitBg = document.getElementById('circuitBg');
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            // Cr√©er des chemins SVG pour les circuits
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.top = '0';
            svg.style.left = '0';
            
            // Cr√©er plusieurs chemins de circuit
            const paths = [
                `M 50 100 L 200 100 L 200 200 L 400 200 L 400 350`,
                `M 100 50 L 100 150 L 300 150 L 300 300 L 450 300`,
                `M ${width-100} 100 L ${width-100} 250 L ${width-300} 250 L ${width-300} 400`,
                `M 150 ${height-100} L 150 ${height-200} L 350 ${height-200} L 350 ${height-300}`,
                `M ${width/2} 50 L ${width/2} 150 L ${width/2+100} 150 L ${width/2+100} 250`
            ];
            
            paths.forEach((pathData, index) => {
                // Chemin de base
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('class', 'circuit-path');
                path.setAttribute('id', `path${index}`);
                svg.appendChild(path);
                
                // Chemin lumineux
                const glowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                glowPath.setAttribute('d', pathData);
                glowPath.setAttribute('class', 'circuit-path-glow');
                glowPath.setAttribute('stroke-dasharray', '1000');
                glowPath.style.animationDelay = `${index * 0.8}s`;
                svg.appendChild(glowPath);
                
                // Cr√©er des particules √©lectriques
                for (let i = 0; i < 3; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'electric-current';
                    particle.style.offsetPath = `path('${pathData}')`;
                    particle.style.animationDelay = `${index * 0.8 + i * 1.3}s`;
                    particle.style.animationDuration = `${3 + Math.random() * 2}s`;
                    circuitBg.appendChild(particle);
                }
            });
            
            circuitBg.appendChild(svg);
            
            // G√©n√©rer les lignes de circuit classiques
            for (let i = 0; i < 20; i++) {
                // Lignes horizontales avec flux √©lectrique
                const hLine = document.createElement('div');
                hLine.className = 'circuit-line horizontal';
                hLine.style.left = Math.random() * (width - 100) + 'px';
                hLine.style.top = Math.random() * height + 'px';
                hLine.style.width = (50 + Math.random() * 200) + 'px';
                hLine.style.animationDelay = (Math.random() * 3) + 's,' + (Math.random() * 3) + 's';
                
                const hFlow = document.createElement('div');
                hFlow.className = 'electric-flow';
                hFlow.style.animationDelay = Math.random() * 2 + 's';
                hLine.appendChild(hFlow);
                
                circuitBg.appendChild(hLine);
                
                // Lignes verticales avec flux √©lectrique
                const vLine = document.createElement('div');
                vLine.className = 'circuit-line vertical';
                vLine.style.left = Math.random() * width + 'px';
                vLine.style.top = Math.random() * (height - 100) + 'px';
                vLine.style.height = (50 + Math.random() * 200) + 'px';
                vLine.style.animationDelay = (Math.random() * 3) + 's,' + (Math.random() * 3) + 's';
                
                const vFlow = document.createElement('div');
                vFlow.className = 'electric-flow';
                vFlow.style.animationDelay = Math.random() * 2 + 's';
                vLine.appendChild(vFlow);
                
                circuitBg.appendChild(vLine);
                
                // N≈ìuds de connexion actifs
                if (i % 3 === 0) {
                    const node = document.createElement('div');
                    node.className = 'circuit-node active';
                    node.style.left = hLine.style.left;
                    node.style.top = hLine.style.top;
                    node.style.transform = 'translate(-50%, -50%)';
                    node.style.animationDelay = Math.random() * 2 + 's';
                    circuitBg.appendChild(node);
                }
            }
            
            // G√©n√©rer plus de LEDs clignotantes
            for (let i = 0; i < 50; i++) {
                const led = document.createElement('div');
                led.className = 'circuit-led';
                led.style.left = Math.random() * width + 'px';
                led.style.top = Math.random() * height + 'px';
                led.style.animationDelay = Math.random() * 2 + 's';
                led.style.animationDuration = (0.5 + Math.random() * 1.5) + 's';
                circuitBg.appendChild(led);
            }
        }
        
        function createCircuitPaths() {
            const circuitBg = document.getElementById('circuitBg');
            const paths = [
                // Chemin 1
                { x: 10, y: 20, segments: [
                    { dir: 'h', len: 15 },
                    { dir: 'v', len: 10 },
                    { dir: 'h', len: 20 },
                    { dir: 'v', len: -5 },
                    { dir: 'h', len: 10 }
                ]},
                // Chemin 2
                { x: 60, y: 10, segments: [
                    { dir: 'v', len: 15 },
                    { dir: 'h', len: -10 },
                    { dir: 'v', len: 10 },
                    { dir: 'h', len: 15 }
                ]},
                // Chemin 3
                { x: 80, y: 50, segments: [
                    { dir: 'h', len: -20 },
                    { dir: 'v', len: -10 },
                    { dir: 'h', len: -15 },
                    { dir: 'v', len: 15 }
                ]}
            ];
            
            paths.forEach((path, index) => {
                let currentX = (path.x / 100) * window.innerWidth;
                let currentY = (path.y / 100) * window.innerHeight;
                
                path.segments.forEach((segment, segIndex) => {
                    const line = document.createElement('div');
                    line.className = 'circuit-line';
                    
                    if (segment.dir === 'h') {
                        line.classList.add('horizontal');
                        line.style.left = (segment.len > 0 ? currentX : currentX + segment.len * 10) + 'px';
                        line.style.top = currentY + 'px';
                        line.style.width = Math.abs(segment.len * 10) + 'px';
                        currentX += segment.len * 10;
                    } else {
                        line.classList.add('vertical');
                        line.style.left = currentX + 'px';
                        line.style.top = (segment.len > 0 ? currentY : currentY + segment.len * 10) + 'px';
                        line.style.height = Math.abs(segment.len * 10) + 'px';
                        currentY += segment.len * 10;
                    }
                    
                    line.style.animationDelay = (index * 0.5 + segIndex * 0.2) + 's,' + (index * 0.5 + segIndex * 0.2 + 0.1) + 's';
                    circuitBg.appendChild(line);
                    
                    // Ajouter un n≈ìud √† chaque jonction
                    if (segIndex < path.segments.length - 1) {
                        const node = document.createElement('div');
                        node.className = 'circuit-node active';
                        node.style.left = currentX + 'px';
                        node.style.top = currentY + 'px';
                        node.style.transform = 'translate(-50%, -50%)';
                        node.style.animationDelay = (index * 0.5 + segIndex * 0.2) + 's';
                        circuitBg.appendChild(node);
                    }
                });
            });
        }
        
        // R√©g√©n√©rer le circuit lors du redimensionnement
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const circuitBg = document.getElementById('circuitBg');
                // Supprimer seulement les √©l√©ments dynamiques
                const toRemove = circuitBg.querySelectorAll('.circuit-line, .circuit-node, .circuit-led, .electric-current, .electric-particle, .electric-diagonal, .electric-vertical, svg');
                toRemove.forEach(el => el.remove());
                
                // R√©g√©n√©rer les circuits
                generateCircuitBackground();
            }, 300);
        });
        
        // Persistance locale des fichiers (pour l'interface Claude)
        function saveToLocalStorage() {
            try {
                const data = {
                    fileSystem: fileSystem,
                    openTabs: openTabs,
                    activeFiles: activeFiles,
                    editorThemes: editorThemes
                };
                localStorage.setItem('codeEditPro_data', JSON.stringify(data));
            } catch (e) {
                console.log('Sauvegarde locale non disponible');
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('codeEditPro_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.fileSystem && Object.keys(data.fileSystem).length > 0) {
                        fileSystem = data.fileSystem;
                        openTabs = data.openTabs || [];
                        activeFiles = data.activeFiles || { 1: null, 2: null };
                        editorThemes = data.editorThemes || { 1: 'vs-dark', 2: 'cyberpunk-2077' };
                        updateFileTree();
                        showNotification('Projet restaur√© depuis la session pr√©c√©dente', 'success');
                        return true;
                    }
                }
            } catch (e) {
                console.log('Chargement local non disponible');
            }
            return false;
        }
        
        // Sauvegarder automatiquement
        setInterval(saveToLocalStorage, 5000);
        
        // Charger les donn√©es sauvegard√©es
        if (loadFromLocalStorage() && activeFiles[1]) {
            setTimeout(() => {
                openFileInEditor(activeFiles[1], 1);
            }, 500);
        } else {
            // Ouvrir automatiquement le fichier index.html au d√©marrage
            setTimeout(() => {
                const indexFile = findFileInSystem('index.html');
                if (indexFile) {
                    openFileInEditor('index.html', 1);
                }
            }, 500);
        }
        setTimeout(() => {
            showNotification('‚ö° Interface Cyberpunk activ√©e! Explorez les fichiers √† gauche.', 'success');
        }, 2000);
        
        setTimeout(() => {
            if (window.innerWidth <= 768) {
                showNotification('üì± Toolbar mobile disponible lors de l\'√©dition!', 'success');
            } else {
                showNotification('üé® Essayez Split View pour multi-√©diteurs avec th√®mes!', 'success');
            }
        }, 4000);
        // Optimisation des performances
        let animationFrameId;
        function optimizeAnimations() {
            const circuitBg = document.getElementById('circuitBg');
            const isVisible = document.visibilityState === 'visible';
            
            if (isVisible) {
                circuitBg.style.animationPlayState = 'running';
            } else {
                circuitBg.style.animationPlayState = 'paused';
            }
        }
        
        document.addEventListener('visibilitychange', optimizeAnimations);
        
        // Gestion de la m√©moire
        window.addEventListener('beforeunload', () => {
            saveToLocalStorage();
            if (editor) editor.dispose();
            if (editor2) editor2.dispose();
        });
        
        // D√©tection de la performance
        if (window.performance && window.performance.memory) {
            setInterval(() => {
                const used = window.performance.memory.usedJSHeapSize;
                const limit = window.performance.memory.jsHeapSizeLimit;
                const percent = (used / limit) * 100;
                
                if (percent > 90) {
                    console.warn('M√©moire √©lev√©e d√©tect√©e. Consid√©rez fermer des onglets.');
                }
            }, 30000);
        }
        
        // Initialisation des circuits √©lectriques
        function initializeCircuitBackground() {
            const circuitBg = document.getElementById('circuitBg');
            if (!circuitBg) return;
            
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            // G√©n√©rer des particules √©lectriques qui traversent l'√©cran
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'electric-particle';
                particle.style.top = Math.random() * height + 'px';
                particle.style.animationDelay = i * 0.5 + 's';
                particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                circuitBg.appendChild(particle);
            }
            
            // Particules diagonales
            for (let i = 0; i < 5; i++) {
                const diagonal = document.createElement('div');
                diagonal.className = 'electric-diagonal';
                diagonal.style.animationDelay = i * 1.5 + 's';
                circuitBg.appendChild(diagonal);
            }
            
            // Flux vertical
            for (let i = 0; i < 8; i++) {
                const vertical = document.createElement('div');
                vertical.className = 'electric-vertical';
                vertical.style.left = Math.random() * width + 'px';
                vertical.style.animationDelay = i * 0.7 + 's';
                vertical.style.animationDuration = (3 + Math.random() * 2) + 's';
                circuitBg.appendChild(vertical);
            }
            
            // Cr√©er les chemins de circuit
            createCircuitPaths();
        }
        
        // Appeler l'initialisation apr√®s le chargement
        document.addEventListener('DOMContentLoaded', initializeCircuitBackground);
        
        // Fin du script
        console.log('‚úÖ CodeEdit Pro charg√© avec succ√®s!');
    </script>
</body>
</html>