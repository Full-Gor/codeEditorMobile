<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Code Editor Mobile Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: #2d2d30;
            display: flex;
            align-items: center;
            padding: 8px;
            gap: 8px;
            flex-shrink: 0;
            border-bottom: 1px solid #3e3e42;
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
            color: #007acc;
            margin-right: auto;
        }
        
        .header-btn {
            background: none;
            border: none;
            color: #ccc;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            position: relative;
        }
        
        .header-btn:hover {
            background: #3e3e42;
            color: #fff;
        }
        
        .header-btn.active {
            background: #094771;
            color: #fff;
        }
        
        .header-btn.run-btn {
            background: #0e639c;
            color: #fff;
        }
        
        .header-btn.run-btn:hover {
            background: #1177bb;
        }
        
        /* Menu Fichier */
        .file-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            min-width: 220px;
        }
        
        .file-menu.active {
            display: block;
        }
        
        .file-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid #3e3e42;
            transition: background 0.2s;
        }
        
        .file-menu-item:last-child {
            border-bottom: none;
        }
        
        .file-menu-item:hover {
            background: #094771;
        }
        
        .file-menu-item span {
            float: right;
            color: #888;
            font-size: 11px;
        }
        
        /* Tabs */
        .tabs-container {
            background: #252526;
            display: flex;
            overflow-x: auto;
            scrollbar-width: thin;
            flex-shrink: 0;
            border-bottom: 1px solid #3e3e42;
        }
        
        .tab {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #2d2d30;
            border-right: 1px solid #252526;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: background 0.2s;
        }
        
        .tab.active {
            background: #1e1e1e;
            color: #fff;
        }
        
        .tab:hover {
            background: #37373d;
        }
        
        .tab-close {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.5;
            font-size: 16px;
        }
        
        .tab-close:hover {
            opacity: 1;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        /* Explorer amélioré */
        .explorer {
            width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s;
        }
        
        .explorer.hidden {
            margin-left: -250px;
        }
        
        .explorer-header {
            background: #2d2d30;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3e3e42;
        }
        
        .explorer-title {
            font-size: 12px;
            text-transform: uppercase;
            color: #ccc;
        }
        
        .explorer-actions {
            display: flex;
            gap: 8px;
        }
        
        .explorer-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        .explorer-btn:hover {
            background: #3e3e42;
            color: #fff;
        }
        
        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }
        
        .tree-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background 0.2s;
            gap: 6px;
            user-select: none;
        }
        
        .tree-item:hover {
            background: #37373d;
        }
        
        .tree-item.active {
            background: #094771;
        }
        
        .tree-item.folder {
            font-weight: 500;
        }
        
        .tree-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tree-children {
            margin-left: 20px;
            display: none;
        }
        
        .tree-children.expanded {
            display: block;
        }
        
        /* Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-wrapper {
            flex: 1;
            position: relative;
            display: none;
        }
        
        .editor-wrapper.active {
            display: block;
        }
        
        #editor {
            width: 100%;
            height: 100%;
        }
        
        /* Preview Container */
        .preview-container {
            flex: 1;
            display: none;
            background: #fff;
            position: relative;
        }
        
        .preview-container.active {
            display: block;
        }
        
        .preview-header {
            background: #f3f3f3;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .preview-url {
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }
        
        .preview-close {
            cursor: pointer;
            font-size: 20px;
            color: #666;
        }
        
        .preview-frame {
            width: 100%;
            height: calc(100% - 40px);
            border: none;
        }
        
        /* Media Viewer */
        .media-viewer {
            flex: 1;
            display: none;
            background: #1e1e1e;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        .media-viewer.active {
            display: flex;
        }
        
        .media-content {
            max-width: 100%;
            max-height: 100%;
        }
        
        .media-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .media-content video,
        .media-content audio {
            max-width: 100%;
            outline: none;
        }
        
        .media-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Search Panel */
        .search-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 500px;
            display: none;
            z-index: 200;
        }
        
        .search-panel.active {
            display: block;
        }
        
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .search-result {
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 4px;
            transition: background 0.2s;
        }
        
        .search-result:hover {
            background: #37373d;
        }
        
        /* Theme Selector */
        .theme-selector {
            position: absolute;
            top: 50px;
            right: 10px;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 8px;
            display: none;
            z-index: 150;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .theme-selector.active {
            display: block;
        }
        
        .theme-option {
            padding: 6px 12px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .theme-option:hover {
            background: #37373d;
        }
        
        /* Status Bar */
        .status-bar {
            background: #007acc;
            color: #fff;
            padding: 4px 12px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-info {
            display: flex;
            gap: 20px;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 60px;
            right: 20px;
            background: rgba(0, 122, 204, 0.9);
            color: #fff;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 13px;
            display: none;
            animation: slideIn 0.3s, slideOut 0.3s 2.7s;
            z-index: 1000;
        }
        
        .notification.success {
            background: rgba(73, 156, 84, 0.9);
        }
        
        .notification.error {
            background: rgba(220, 53, 69, 0.9);
        }
        
        @keyframes slideIn {
            from { transform: translateX(300px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(300px); opacity: 0; }
        }
        
        /* Input file caché */
        #fileInput, #folderInput {
            display: none;
        }
        
        /* Bouton flottant pour mobile */
        .fab-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            display: none;
            flex-direction: column-reverse;
            gap: 10px;
            z-index: 100;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            background: #007acc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .fab:hover {
            transform: scale(1.1);
            background: #1177bb;
        }
        
        .fab-menu {
            background: #252526;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: none;
        }
        
        .fab-menu.active {
            display: block;
        }
        
        .fab-item {
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            white-space: nowrap;
            transition: background 0.2s;
        }
        
        .fab-item:hover {
            background: #37373d;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .explorer {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                z-index: 50;
                box-shadow: 2px 0 5px rgba(0,0,0,0.3);
            }
            
            .explorer.hidden {
                left: -250px;
            }
            
            .fab-container {
                display: flex;
            }
            
            .header-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
        }
        
        /* Dialogs */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .dialog-overlay.active {
            display: flex;
        }
        
        .dialog {
            background: #252526;
            border-radius: 8px;
            padding: 20px;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .dialog-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .dialog-input {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .dialog-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .dialog-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }
        
        .dialog-btn.primary {
            background: #0e639c;
            color: #fff;
        }
        
        .dialog-btn.primary:hover {
            background: #1177bb;
        }
        
        .dialog-btn.secondary {
            background: #3e3e42;
            color: #ccc;
        }
        
        .dialog-btn.secondary:hover {
            background: #4e4e52;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">CodeEdit Pro</div>
        <div style="position: relative;">
            <button class="header-btn" onclick="toggleFileMenu()" id="fileMenuBtn">📄 Fichier</button>
            <div class="file-menu" id="fileMenu">
                <div class="file-menu-item" onclick="openFile()">
                    Ouvrir un fichier <span>Ctrl+O</span>
                </div>
                <div class="file-menu-item" onclick="openFolder()">
                    Ouvrir un dossier
                </div>
                <div class="file-menu-item" onclick="saveFile()">
                    Enregistrer <span>Ctrl+S</span>
                </div>
                <div class="file-menu-item" onclick="saveAsFile()">
                    Enregistrer sous... <span>Ctrl+Shift+S</span>
                </div>
                <div class="file-menu-item" onclick="newFile()">
                    Nouveau fichier <span>Ctrl+N</span>
                </div>
                <div class="file-menu-item" onclick="newFolder()">
                    Nouveau dossier
                </div>
            </div>
        </div>
        <button class="header-btn" onclick="toggleExplorer()" id="explorerBtn">📁</button>
        <button class="header-btn" onclick="toggleSearch()">🔍</button>
        <button class="header-btn run-btn" onclick="runProject()">▶️ Run</button>
        <button class="header-btn" onclick="toggleTheme()">🎨</button>
    </div>
    
    <div class="tabs-container" id="tabs"></div>
    
    <div class="main-content">
        <div class="explorer" id="explorer">
            <div class="explorer-header">
                <span class="explorer-title">Explorateur</span>
                <div class="explorer-actions">
                    <button class="explorer-btn" onclick="newFile()" title="Nouveau fichier">📄</button>
                    <button class="explorer-btn" onclick="newFolder()" title="Nouveau dossier">📁</button>
                    <button class="explorer-btn" onclick="toggleExplorer()" title="Fermer">✕</button>
                </div>
            </div>
            <div class="file-tree" id="fileTree"></div>
        </div>
        
        <div class="editor-container">
            <div class="editor-wrapper active" id="editorWrapper">
                <div id="editor"></div>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <div class="preview-header">
                    <span class="preview-url">Preview: <span id="previewUrl"></span></span>
                    <span class="preview-close" onclick="closePreview()">✕</span>
                </div>
                <iframe class="preview-frame" id="previewFrame"></iframe>
            </div>
            
            <div class="media-viewer" id="mediaViewer">
                <button class="media-close" onclick="closeMediaViewer()">✕</button>
                <div class="media-content" id="mediaContent"></div>
            </div>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-info">
            <span id="cursorPosition">Ln 1, Col 1</span>
            <span id="languageMode">HTML</span>
            <span id="fileStatus">Non enregistré</span>
        </div>
        <div>
            <span>! + Tab = HTML5 | Alt+Click = Multi-curseur</span>
        </div>
    </div>
    
    <div class="search-panel" id="searchPanel">
        <div class="search-header">
            <h3 style="margin: 0;">Rechercher</h3>
            <span class="preview-close" onclick="toggleSearch()">✕</span>
        </div>
        <input type="text" class="search-input" placeholder="Rechercher dans le projet..." id="searchInput" />
        <div class="search-results" id="searchResults"></div>
    </div>
    
    <div class="theme-selector" id="themeSelector">
        <div class="theme-option" onclick="changeTheme('vs-dark')">🌙 Dark (défaut)</div>
        <div class="theme-option" onclick="changeTheme('vs')">☀️ Light</div>
        <div class="theme-option" onclick="changeTheme('hc-black')">⚡ High Contrast</div>
        <div class="theme-option" onclick="changeTheme('scarlet-protocol')">🔴 SCARLET Protocol</div>
        <div class="theme-option" onclick="changeTheme('cyberpunk')">🌃 Cyberpunk</div>
        <div class="theme-option" onclick="changeTheme('cyberpunk-2077')">🎮 Cyberpunk 2077</div>
        <div class="theme-option" onclick="changeTheme('neon-genesis')">💜 Neon Genesis</div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <!-- Inputs cachés pour les fichiers -->
    <input type="file" id="fileInput" accept="*">
    <input type="file" id="folderInput" webkitdirectory directory multiple>
    
    <!-- Dialogs -->
    <div class="dialog-overlay" id="dialogOverlay">
        <div class="dialog">
            <div class="dialog-title" id="dialogTitle">Nouveau</div>
            <input type="text" class="dialog-input" id="dialogInput" placeholder="Nom...">
            <div class="dialog-actions">
                <button class="dialog-btn secondary" onclick="closeDialog()">Annuler</button>
                <button class="dialog-btn primary" id="dialogConfirm">Créer</button>
            </div>
        </div>
    </div>
    
    <!-- Bouton flottant pour mobile -->
    <div class="fab-container">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item" onclick="runProject()">▶️ Run projet</div>
            <div class="fab-item" onclick="saveFile()">💾 Enregistrer</div>
            <div class="fab-item" onclick="saveAsFile()">💾 Enregistrer sous...</div>
            <div class="fab-item" onclick="openFile()">📂 Ouvrir fichier</div>
            <div class="fab-item" onclick="newFile()">📄 Nouveau fichier</div>
            <div class="fab-item" onclick="newFolder()">📁 Nouveau dossier</div>
        </div>
        <div class="fab" onclick="toggleFabMenu()">+</div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <script>
        // Configuration Monaco Editor
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
        
        let editor;
        let currentFile = null;
        let currentFileHandle = null;
        let openTabs = [];
        let fileSystem = {};
        let isModified = false;
        let currentPath = [];
        
        // Détection du support File System Access API
        const supportsFileSystemAccess = 'showOpenFilePicker' in window;
        
        // Types de fichiers supportés
        const fileTypes = {
            code: ['html', 'htm', 'css', 'js', 'jsx', 'ts', 'tsx', 'json', 'php', 'md', 'txt', 'xml', 'svg'],
            image: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'ico'],
            video: ['mp4', 'webm', 'ogg', 'mov'],
            audio: ['mp3', 'wav', 'ogg', 'flac', 'm4a']
        };
        
        // Définition des thèmes personnalisés
        const customThemes = {
            'scarlet-protocol': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '8B0000' },
                    { token: 'keyword', foreground: 'FF0000' },
                    { token: 'string', foreground: 'DC143C' },
                    { token: 'number', foreground: 'FF6347' },
                    { token: 'variable', foreground: 'FF1493' },
                    { token: 'function', foreground: 'FF69B4' },
                    { token: 'type', foreground: 'B22222' }
                ],
                colors: {
                    'editor.background': '#1a0000',
                    'editor.foreground': '#FFB6C1',
                    'editor.lineHighlightBackground': '#330000',
                    'editor.selectionBackground': '#660000',
                    'editorCursor.foreground': '#FF0000',
                    'editorLineNumber.foreground': '#8B0000'
                }
            },
            'cyberpunk': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '00CED1' },
                    { token: 'keyword', foreground: 'FF1493' },
                    { token: 'string', foreground: '00FF00' },
                    { token: 'number', foreground: 'FFD700' },
                    { token: 'variable', foreground: 'FF00FF' },
                    { token: 'function', foreground: '00FFFF' },
                    { token: 'type', foreground: 'FF69B4' }
                ],
                colors: {
                    'editor.background': '#0a0a0a',
                    'editor.foreground': '#00FF00',
                    'editor.lineHighlightBackground': '#1a1a1a',
                    'editor.selectionBackground': '#FF149344',
                    'editorCursor.foreground': '#00FFFF',
                    'editorLineNumber.foreground': '#FF1493'
                }
            },
            'cyberpunk-2077': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: 'FFFF00' },
                    { token: 'keyword', foreground: 'FF0080' },
                    { token: 'string', foreground: '00FFFF' },
                    { token: 'number', foreground: 'FFFF00' },
                    { token: 'variable', foreground: 'FF00FF' },
                    { token: 'function', foreground: '00FF00' },
                    { token: 'type', foreground: 'FF0080' }
                ],
                colors: {
                    'editor.background': '#0F0F0F',
                    'editor.foreground': '#F0F0F0',
                    'editor.lineHighlightBackground': '#1F1F1F',
                    'editor.selectionBackground': '#FF008044',
                    'editorCursor.foreground': '#FFFF00',
                    'editorLineNumber.foreground': '#FF0080'
                }
            },
            'neon-genesis': {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'comment', foreground: '9370DB' },
                    { token: 'keyword', foreground: 'FF00FF' },
                    { token: 'string', foreground: '00CED1' },
                    { token: 'number', foreground: 'FF1493' },
                    { token: 'variable', foreground: 'DA70D6' },
                    { token: 'function', foreground: 'FF69B4' },
                    { token: 'type', foreground: 'EE82EE' }
                ],
                colors: {
                    'editor.background': '#0a0015',
                    'editor.foreground': '#E6E6FA',
                    'editor.lineHighlightBackground': '#1a0025',
                    'editor.selectionBackground': '#9370DB44',
                    'editorCursor.foreground': '#FF00FF',
                    'editorLineNumber.foreground': '#9370DB'
                }
            }
        };
        
        // Initialisation de l'éditeur
        require(['vs/editor/editor.main'], function() {
            // Enregistrer les thèmes personnalisés
            Object.entries(customThemes).forEach(([name, theme]) => {
                monaco.editor.defineTheme(name, theme);
            });
            
            // Configuration Emmet
            monaco.languages.registerCompletionItemProvider('html', {
                provideCompletionItems: function(model, position) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });
                    
                    const match = textUntilPosition.match(/([\w\-!]+(?:[>+][\w\-]+)*(?:\*\d+)?(?:\[[\w\-]+(?:=["']?[\w\s]+["']?)?\])*(?:\{[^}]+\})?(?:#[\w\-]+)?(?:\.[\w\-]+)*|!)$/);
                    
                    if (!match) return { suggestions: [] };
                    
                    const emmetExpression = match[1];
                    const expandedHtml = expandEmmet(emmetExpression);
                    
                    if (!expandedHtml) return { suggestions: [] };
                    
                    return {
                        suggestions: [{
                            label: emmetExpression,
                            kind: monaco.languages.CompletionItemKind.Snippet,
                            insertText: expandedHtml,
                            insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                            detail: 'Emmet Abbreviation',
                            documentation: expandedHtml,
                            range: {
                                startLineNumber: position.lineNumber,
                                endLineNumber: position.lineNumber,
                                startColumn: position.column - emmetExpression.length,
                                endColumn: position.column
                            }
                        }]
                    };
                },
                triggerCharacters: ['>', '*', '+', '.', '#', '[', '{', '!']
            });
            
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: '// Bienvenue dans CodeEdit Pro!\n// \n// 📝 Raccourcis utiles:\n// • Tapez ! puis Tab pour créer une structure HTML5 complète\n// • Ctrl+S pour sauvegarder\n// • Alt+Click pour multi-curseur\n// \n// 📂 Utilisez Fichier > Ouvrir pour ouvrir vos fichiers\n// ▶️ Cliquez sur Run pour prévisualiser votre HTML\n// 🖼️ Supporté: Images, Vidéos, Audio',
                language: 'javascript',
                theme: 'vs-dark',
                minimap: { enabled: false },
                fontSize: 14,
                wordWrap: 'on',
                automaticLayout: true,
                scrollBeyondLastLine: false,
                quickSuggestions: true,
                parameterHints: { enabled: true },
                suggestOnTriggerCharacters: true,
                tabSize: 2,
                insertSpaces: true,
                formatOnPaste: true,
                formatOnType: true,
                multiCursorModifier: 'alt',
                mouseWheelZoom: true,
                cursorBlinking: 'smooth',
                smoothScrolling: true,
                renderWhitespace: 'selection',
                renderLineHighlight: 'all'
            });
            
            // Gestion du multi-curseur
            editor.onMouseDown((e) => {
                if (e.event.altKey) {
                    e.event.preventDefault();
                    e.event.stopPropagation();
                }
            });
            
            // Mise à jour de la position du curseur
            editor.onDidChangeCursorPosition((e) => {
                const position = e.position;
                document.getElementById('cursorPosition').textContent = `Ln ${position.lineNumber}, Col ${position.column}`;
            });
            
            // Détection des modifications
            editor.onDidChangeModelContent(() => {
                if (!isModified) {
                    isModified = true;
                    updateFileStatus();
                }
            });
            
            // Configuration mobile
            if (window.innerWidth < 768) {
                editor.updateOptions({ fontSize: 12 });
            }
            
            // Raccourci Tab pour Emmet
            editor.addCommand(monaco.KeyCode.Tab, () => {
                const position = editor.getPosition();
                const model = editor.getModel();
                const textBeforeCursor = model.getValueInRange({
                    startLineNumber: position.lineNumber,
                    startColumn: 1,
                    endLineNumber: position.lineNumber,
                    endColumn: position.column
                });
                
                const emmetMatch = textBeforeCursor.match(/([\w\-!]+(?:[>+][\w\-]+)*(?:\*\d+)?(?:\[[\w\-]+(?:=["']?[\w\s]+["']?)?\])*(?:\{[^}]+\})?(?:#[\w\-]+)?(?:\.[\w\-]+)*|!)$/);
                
                if (emmetMatch) {
                    const emmetExpression = emmetMatch[1];
                    const expandedHtml = expandEmmet(emmetExpression);
                    
                    if (expandedHtml) {
                        const range = new monaco.Range(
                            position.lineNumber,
                            position.column - emmetExpression.length,
                            position.lineNumber,
                            position.column
                        );
                        
                        editor.executeEdits('emmet', [{
                            range: range,
                            text: expandedHtml,
                            forceMoveMarkers: true
                        }]);
                        
                        // Positionner le curseur dans le body pour !
                        if (emmetExpression === '!') {
                            const newPosition = editor.getPosition();
                            const model = editor.getModel();
                            const match = model.findMatches('<body>', false, false, false, null, false)[0];
                            if (match) {
                                editor.setPosition({
                                    lineNumber: match.range.endLineNumber + 1,
                                    column: 5
                                });
                            }
                        }
                        
                        showNotification(`Emmet: ${emmetExpression} → Expansé!`);
                        return;
                    }
                }
                
                // Comportement Tab normal
                editor.trigger('keyboard', 'type', { text: '\t' });
            });
        });
        
        // Fonction d'expansion Emmet améliorée
        function expandEmmet(abbreviation) {
            // Raccourci ! pour doctype HTML5
            if (abbreviation === '!') {
                return `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    $0
</body>
</html>`;
            }
            
            // Parse multiplication
            const multiplyMatch = abbreviation.match(/^(.+)\*(\d+)$/);
            let baseAbbr = abbreviation;
            let count = 1;
            
            if (multiplyMatch) {
                baseAbbr = multiplyMatch[1];
                count = parseInt(multiplyMatch[2]);
            }
            
            // Parse basic tag avec classes et id
            const tagMatch = baseAbbr.match(/^(\w+)(#[\w-]+)?(\.[\w-]+)*$/);
            if (!tagMatch) return null;
            
            const tag = tagMatch[1];
            const id = tagMatch[2] ? tagMatch[2].substring(1) : '';
            const classes = baseAbbr.match(/\.[\w-]+/g);
            const classStr = classes ? classes.map(c => c.substring(1)).join(' ') : '';
            
            let result = '';
            
            for (let i = 0; i < count; i++) {
                let attrs = '';
                if (id) attrs += ` id="${id}"`;
                if (classStr) attrs += ` class="${classStr}"`;
                
                result += `<${tag}${attrs}></${tag}>\n`;
            }
            
            return result.trim();
        }
        
        // Fonction de notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Gestion du menu fichier
        function toggleFileMenu() {
            const menu = document.getElementById('fileMenu');
            menu.classList.toggle('active');
            document.getElementById('fileMenuBtn').classList.toggle('active');
        }
        
        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-btn') && !e.target.closest('.file-menu')) {
                document.getElementById('fileMenu').classList.remove('active');
                document.getElementById('fileMenuBtn').classList.remove('active');
            }
            
            if (!e.target.closest('.theme-selector') && !e.target.matches('[onclick*="toggleTheme"]')) {
                document.getElementById('themeSelector').classList.remove('active');
            }
        });
        
        // Ouvrir un fichier
        async function openFile() {
            toggleFileMenu();
            
            if (supportsFileSystemAccess) {
                try {
                    const [fileHandle] = await window.showOpenFilePicker({
                        multiple: false
                    });
                    
                    const file = await fileHandle.getFile();
                    const extension = file.name.split('.').pop().toLowerCase();
                    
                    // Vérifier le type de fichier
                    if (fileTypes.code.includes(extension)) {
                        // Fichier de code
                        const content = await file.text();
                        currentFileHandle = fileHandle;
                        currentFile = file.name;
                        
                        const language = getLanguageFromExtension(extension);
                        
                        fileSystem[file.name] = {
                            type: 'file',
                            content: content,
                            language: language,
                            handle: fileHandle
                        };
                        
                        openTab(file.name);
                        showCodeEditor();
                        editor.setValue(content);
                        monaco.editor.setModelLanguage(editor.getModel(), language);
                        
                        isModified = false;
                        updateFileStatus();
                        updateFileTree();
                        
                        showNotification(`Fichier ouvert: ${file.name}`, 'success');
                        
                    } else if (fileTypes.image.includes(extension)) {
                        // Image
                        showMediaViewer('image', URL.createObjectURL(file), file.name);
                        
                    } else if (fileTypes.video.includes(extension)) {
                        // Vidéo
                        showMediaViewer('video', URL.createObjectURL(file), file.name);
                        
                    } else if (fileTypes.audio.includes(extension)) {
                        // Audio
                        showMediaViewer('audio', URL.createObjectURL(file), file.name);
                        
                    } else {
                        showNotification('Type de fichier non supporté', 'error');
                    }
                    
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Erreur lors de l\'ouverture du fichier', 'error');
                    }
                }
            } else {
                // Fallback pour les navigateurs qui ne supportent pas l'API
                document.getElementById('fileInput').click();
            }
        }
        
        // Fallback pour input file
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const extension = file.name.split('.').pop().toLowerCase();
                
                if (fileTypes.code.includes(extension)) {
                    const content = await file.text();
                    currentFile = file.name;
                    
                    const language = getLanguageFromExtension(extension);
                    
                    fileSystem[file.name] = {
                        type: 'file',
                        content: content,
                        language: language
                    };
                    
                    openTab(file.name);
                    showCodeEditor();
                    editor.setValue(content);
                    monaco.editor.setModelLanguage(editor.getModel(), language);
                    
                    isModified = false;
                    updateFileStatus();
                    updateFileTree();
                    
                    showNotification(`Fichier ouvert: ${file.name}`, 'success');
                    
                } else if (fileTypes.image.includes(extension) || 
                          fileTypes.video.includes(extension) || 
                          fileTypes.audio.includes(extension)) {
                    const url = URL.createObjectURL(file);
                    const type = fileTypes.image.includes(extension) ? 'image' : 
                                 fileTypes.video.includes(extension) ? 'video' : 'audio';
                    showMediaViewer(type, url, file.name);
                }
            }
        });
        
        // Afficher le viewer média
        function showMediaViewer(type, url, filename) {
            const mediaContent = document.getElementById('mediaContent');
            mediaContent.innerHTML = '';
            
            if (type === 'image') {
                mediaContent.innerHTML = `<img src="${url}" alt="${filename}">`;
            } else if (type === 'video') {
                mediaContent.innerHTML = `<video src="${url}" controls></video>`;
            } else if (type === 'audio') {
                mediaContent.innerHTML = `<audio src="${url}" controls></audio>`;
            }
            
            document.getElementById('editorWrapper').classList.remove('active');
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('mediaViewer').classList.add('active');
            
            showNotification(`Ouvert: ${filename}`, 'success');
        }
        
        // Fermer le viewer média
        function closeMediaViewer() {
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('editorWrapper').classList.add('active');
        }
        
        // Afficher l'éditeur de code
        function showCodeEditor() {
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('editorWrapper').classList.add('active');
        }
        
        // Run le projet
        function runProject() {
            toggleFileMenu();
            
            const content = editor.getValue();
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            document.getElementById('previewUrl').textContent = currentFile || 'preview.html';
            document.getElementById('previewFrame').src = url;
            
            document.getElementById('editorWrapper').classList.remove('active');
            document.getElementById('mediaViewer').classList.remove('active');
            document.getElementById('previewContainer').classList.add('active');
            
            showNotification('Preview lancée!', 'success');
        }
        
        // Fermer la preview
        function closePreview() {
            document.getElementById('previewContainer').classList.remove('active');
            document.getElementById('editorWrapper').classList.add('active');
        }
        
        // Sauvegarder le fichier
        async function saveFile() {
            toggleFileMenu();
            
            if (!currentFile) {
                saveAsFile();
                return;
            }
            
            const content = editor.getValue();
            
            if (supportsFileSystemAccess && currentFileHandle) {
                try {
                    const writable = await currentFileHandle.createWritable();
                    await writable.write(content);
                    await writable.close();
                    
                    isModified = false;
                    updateFileStatus();
                    
                    showNotification('Fichier enregistré!', 'success');
                } catch (err) {
                    showNotification('Erreur lors de l\'enregistrement', 'error');
                }
            } else {
                // Fallback: télécharger le fichier
                downloadFile(currentFile, content);
                isModified = false;
                updateFileStatus();
                showNotification('Fichier téléchargé!', 'success');
            }
        }
        
        // Enregistrer sous
        async function saveAsFile() {
            toggleFileMenu();
            
            const content = editor.getValue();
            
            if (supportsFileSystemAccess) {
                try {
                    const fileHandle = await window.showSaveFilePicker({
                        suggestedName: currentFile || 'nouveau-fichier.html',
                        types: [
                            {
                                description: 'Fichiers de code',
                                accept: {
                                    'text/html': ['.html'],
                                    'text/css': ['.css'],
                                    'text/javascript': ['.js'],
                                    'application/json': ['.json'],
                                    'text/plain': ['.txt']
                                }
                            }
                        ]
                    });
                    
                    const writable = await fileHandle.createWritable();
                    await writable.write(content);
                    await writable.close();
                    
                    currentFileHandle = fileHandle;
                    currentFile = fileHandle.name;
                    
                    isModified = false;
                    updateFileStatus();
                    
                    showNotification('Fichier enregistré!', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Erreur lors de l\'enregistrement', 'error');
                    }
                }
            } else {
                // Fallback
                const filename = prompt('Nom du fichier:', currentFile || 'nouveau-fichier.html');
                if (filename) {
                    downloadFile(filename, content);
                    currentFile = filename;
                    isModified = false;
                    updateFileStatus();
                    showNotification('Fichier téléchargé!', 'success');
                }
            }
        }
        
        // Télécharger le fichier (fallback)
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Nouveau fichier
        function newFile() {
            toggleFileMenu();
            
            showDialog('Nouveau fichier', 'nouveau.html', (filename) => {
                if (filename) {
                    currentFile = filename;
                    currentFileHandle = null;
                    
                    const extension = filename.split('.').pop();
                    const language = getLanguageFromExtension(extension);
                    
                    fileSystem[filename] = {
                        type: 'file',
                        content: '',
                        language: language
                    };
                    
                    openTab(filename);
                    showCodeEditor();
                    editor.setValue('');
                    monaco.editor.setModelLanguage(editor.getModel(), language);
                    
                    isModified = false;
                    updateFileStatus();
                    updateFileTree();
                    
                    showNotification(`Nouveau fichier: ${filename}`, 'success');
                }
            });
        }
        
        // Nouveau dossier
        function newFolder() {
            toggleFileMenu();
            
            showDialog('Nouveau dossier', 'nouveau-dossier', (foldername) => {
                if (foldername) {
                    fileSystem[foldername] = {
                        type: 'folder',
                        children: {}
                    };
                    
                    updateFileTree();
                    showNotification(`Nouveau dossier: ${foldername}`, 'success');
                }
            });
        }
        
        // Afficher une boîte de dialogue
        function showDialog(title, defaultValue, callback) {
            const overlay = document.getElementById('dialogOverlay');
            const dialogTitle = document.getElementById('dialogTitle');
            const dialogInput = document.getElementById('dialogInput');
            const dialogConfirm = document.getElementById('dialogConfirm');
            
            dialogTitle.textContent = title;
            dialogInput.value = defaultValue;
            overlay.classList.add('active');
            
            dialogInput.focus();
            dialogInput.select();
            
            const confirm = () => {
                const value = dialogInput.value.trim();
                if (value) {
                    callback(value);
                    closeDialog();
                }
            };
            
            dialogConfirm.onclick = confirm;
            dialogInput.onkeypress = (e) => {
                if (e.key === 'Enter') confirm();
            };
        }
        
        // Fermer la boîte de dialogue
        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('active');
        }
        
        // Ouvrir un dossier
        async function openFolder() {
            toggleFileMenu();
            
            if ('showDirectoryPicker' in window) {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    fileSystem = {};
                    await loadDirectory(dirHandle, fileSystem);
                    updateFileTree();
                    showNotification('Dossier ouvert!', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showNotification('Erreur lors de l\'ouverture du dossier', 'error');
                    }
                }
            } else {
                showNotification('Votre navigateur ne supporte pas l\'ouverture de dossiers', 'error');
            }
        }
        
        // Charger un dossier récursivement
        async function loadDirectory(dirHandle, parentObj) {
            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'file') {
                    const file = await entry.getFile();
                    const extension = entry.name.split('.').pop().toLowerCase();
                    
                    // Tous les types de fichiers
                    const allTypes = [...fileTypes.code, ...fileTypes.image, ...fileTypes.video, ...fileTypes.audio];
                    
                    if (allTypes.includes(extension)) {
                        parentObj[entry.name] = {
                            type: 'file',
                            handle: entry,
                            language: getLanguageFromExtension(extension)
                        };
                        
                        // Charger le contenu pour les fichiers de code
                        if (fileTypes.code.includes(extension)) {
                            parentObj[entry.name].content = await file.text();
                        }
                    }
                } else if (entry.kind === 'directory') {
                    parentObj[entry.name] = {
                        type: 'folder',
                        children: {}
                    };
                    await loadDirectory(entry, parentObj[entry.name].children);
                }
            }
        }
        
        // Obtenir le langage depuis l'extension
        function getLanguageFromExtension(extension) {
            const languageMap = {
                'html': 'html',
                'htm': 'html',
                'css': 'css',
                'js': 'javascript',
                'jsx': 'javascript',
                'ts': 'typescript',
                'tsx': 'typescript',
                'json': 'json',
                'php': 'php',
                'md': 'markdown',
                'txt': 'plaintext',
                'xml': 'xml',
                'svg': 'xml'
            };
            
            return languageMap[extension] || 'plaintext';
        }
        
        // Mise à jour du statut du fichier
        function updateFileStatus() {
            const status = document.getElementById('fileStatus');
            if (currentFile) {
                status.textContent = isModified ? `${currentFile} (modifié)` : currentFile;
            } else {
                status.textContent = isModified ? 'Non enregistré (modifié)' : 'Non enregistré';
            }
            
            // Mettre à jour le titre de l'onglet
            if (currentFile && openTabs.includes(currentFile)) {
                updateTabs();
            }
        }
        
        // Gestion des onglets
        function updateTabs() {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';
            
            openTabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab' + (tab === currentFile ? ' active' : '');
                const modified = fileSystem[tab] && isModified && tab === currentFile ? '• ' : '';
                tabEl.innerHTML = `
                    <span onclick="switchFile('${tab}')">${modified}${tab}</span>
                    <span class="tab-close" onclick="closeTab('${tab}')">&times;</span>
                `;
                tabsContainer.appendChild(tabEl);
            });
        }
        
        function openTab(filename) {
            if (!openTabs.includes(filename)) {
                openTabs.push(filename);
            }
            switchFile(filename);
        }
        
        function switchFile(filename) {
            if (fileSystem[filename] && fileSystem[filename].type === 'file') {
                const file = fileSystem[filename];
                const extension = filename.split('.').pop().toLowerCase();
                
                if (fileTypes.code.includes(extension)) {
                    currentFile = filename;
                    currentFileHandle = file.handle || null;
                    showCodeEditor();
                    editor.setValue(file.content || '');
                    monaco.editor.setModelLanguage(editor.getModel(), file.language);
                    document.getElementById('languageMode').textContent = file.language.toUpperCase();
                    isModified = false;
                    updateTabs();
                    updateFileTree();
                    updateFileStatus();
                } else if (fileTypes.image.includes(extension) || 
                          fileTypes.video.includes(extension) || 
                          fileTypes.audio.includes(extension)) {
                    // Ouvrir le média
                    if (file.handle) {
                        file.handle.getFile().then(f => {
                            const url = URL.createObjectURL(f);
                            const type = fileTypes.image.includes(extension) ? 'image' : 
                                         fileTypes.video.includes(extension) ? 'video' : 'audio';
                            showMediaViewer(type, url, filename);
                        });
                    }
                }
            }
        }
        
        function closeTab(filename) {
            const index = openTabs.indexOf(filename);
            if (index > -1) {
                openTabs.splice(index, 1);
                if (currentFile === filename && openTabs.length > 0) {
                    switchFile(openTabs[openTabs.length - 1]);
                } else if (openTabs.length === 0) {
                    currentFile = null;
                    currentFileHandle = null;
                    editor.setValue('');
                    updateFileStatus();
                }
                updateTabs();
            }
        }
        
        // Gestion de l'arborescence
        function updateFileTree() {
            const fileTree = document.getElementById('fileTree');
            fileTree.innerHTML = '';
            
            renderTree(fileSystem, fileTree, 0);
        }
        
        function renderTree(items, container, level) {
            Object.entries(items).forEach(([name, item]) => {
                const treeItem = document.createElement('div');
                treeItem.className = 'tree-item';
                treeItem.style.paddingLeft = `${level * 20 + 8}px`;
                
                if (item.type === 'folder') {
                    treeItem.classList.add('folder');
                    treeItem.innerHTML = `
                        <span class="tree-icon">📁</span>
                        <span>${name}</span>
                    `;
                    
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = 'tree-children';
                    
                    treeItem.onclick = () => {
                        childrenContainer.classList.toggle('expanded');
                        treeItem.querySelector('.tree-icon').textContent = 
                            childrenContainer.classList.contains('expanded') ? '📂' : '📁';
                    };
                    
                    container.appendChild(treeItem);
                    container.appendChild(childrenContainer);
                    
                    if (item.children) {
                        renderTree(item.children, childrenContainer, level + 1);
                    }
                } else {
                    const icon = getFileIcon(name);
                    treeItem.innerHTML = `
                        <span class="tree-icon">${icon}</span>
                        <span>${name}</span>
                    `;
                    
                    if (name === currentFile) {
                        treeItem.classList.add('active');
                    }
                    
                    treeItem.onclick = () => {
                        const extension = name.split('.').pop().toLowerCase();
                        if (fileTypes.code.includes(extension)) {
                            openTab(name);
                        } else {
                            switchFile(name);
                        }
                    };
                    
                    container.appendChild(treeItem);
                }
            });
        }
        
        function getFileIcon(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'html': '📄',
                'css': '🎨',
                'js': '📜',
                'jsx': '⚛️',
                'ts': '📘',
                'tsx': '⚛️',
                'json': '📋',
                'php': '🐘',
                'md': '📝',
                'txt': '📃',
                'jpg': '🖼️',
                'jpeg': '🖼️',
                'png': '🖼️',
                'gif': '🖼️',
                'webp': '🖼️',
                'mp4': '🎬',
                'webm': '🎬',
                'mp3': '🎵',
                'wav': '🎵'
            };
            
            return iconMap[extension] || '📄';
        }
        
        // Toggle functions
        function toggleExplorer() {
            const explorer = document.getElementById('explorer');
            explorer.classList.toggle('hidden');
            document.getElementById('explorerBtn').classList.toggle('active');
        }
        
        function toggleSearch() {
            const panel = document.getElementById('searchPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                document.getElementById('searchInput').focus();
            }
        }
        
        function toggleTheme() {
            document.getElementById('themeSelector').classList.toggle('active');
        }
        
        function changeTheme(theme) {
            monaco.editor.setTheme(theme);
            document.getElementById('themeSelector').classList.remove('active');
            
            // Adapter les couleurs de l'interface selon le thème
            if (theme === 'scarlet-protocol') {
                document.querySelector('.status-bar').style.background = '#8B0000';
            } else if (theme === 'cyberpunk' || theme === 'cyberpunk-2077') {
                document.querySelector('.status-bar').style.background = '#FF1493';
            } else if (theme === 'neon-genesis') {
                document.querySelector('.status-bar').style.background = '#9370DB';
            } else {
                document.querySelector('.status-bar').style.background = '#007acc';
            }
        }
        
        // Recherche
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            searchResults.innerHTML = '';
            
            if (query.length > 0) {
                searchFiles(fileSystem, query, searchResults);
            }
        });
        
        function searchFiles(items, query, container) {
            Object.entries(items).forEach(([name, item]) => {
                if (item.type === 'file' && name.toLowerCase().includes(query)) {
                    const result = document.createElement('div');
                    result.className = 'search-result';
                    result.textContent = name;
                    result.onclick = () => {
                        openTab(name);
                        toggleSearch();
                    };
                    container.appendChild(result);
                } else if (item.type === 'folder' && item.children) {
                    searchFiles(item.children, query, container);
                }
            });
        }
        
        // Menu flottant mobile
        function toggleFabMenu() {
            document.getElementById('fabMenu').classList.toggle('active');
        }
        
        // Raccourcis clavier
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 's') {
                    e.preventDefault();
                    saveFile();
                } else if (e.key === 'S') {
                    e.preventDefault();
                    saveAsFile();
                } else if (e.key === 'o') {
                    e.preventDefault();
                    openFile();
                } else if (e.key === 'n') {
                    e.preventDefault();
                    newFile();
                } else if (e.key === 'f') {
                    e.preventDefault();
                    toggleSearch();
                } else if (e.key === 'r') {
                    e.preventDefault();
                    runProject();
                }
            }
        });
        
        // Initialisation
        updateFileTree();
        updateFileStatus();
        
        // Message de bienvenue
        setTimeout(() => {
            showNotification('💡 Astuce: Ctrl+R pour Run votre projet!', 'success');
        }, 2000);
    </script>
</body>
</html>